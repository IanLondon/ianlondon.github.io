<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Ian London's Blog: RSS Feed]]></title><description><![CDATA[A blog of software and other projects]]></description><link>https://ianlondon.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Thu, 01 Feb 2024 07:18:02 GMT</lastBuildDate><item><title><![CDATA[Please Don't Use JSON Web Tokens for Browser Sessions]]></title><description><![CDATA[Or, how I learned to love the session cookie]]></description><link>https://ianlondon.github.io/posts/dont-use-jwts-for-sessions</link><guid isPermaLink="false">dont-use-jwts-for-sessions</guid><pubDate>Sun, 28 Jan 2024 00:00:00 GMT</pubDate><content:encoded>&lt;img src=&quot;https://ianlondon.github.io/static/fbacb21570e228171e745fd5d55ad53d/497c6/they-live-sunglasses.png&quot; /&gt;&lt;h1&gt;JSON Web Tokens&lt;/h1&gt;
&lt;p&gt;In the JavaScript community, JSON Web Tokens (JWTs) generally stored in &lt;code&gt;localStorage&lt;/code&gt; have become a popular way to implement user authentication, especially for Single-Page Apps (SPAs). That&apos;s the way I first learned when I picked up Express in 2016. In the 2010s when I learned Django I used Jinja templates and session cookies and SQL, and in the mid 2010s the new hotness was React Express Mongo and JWTs. Every resource on node/Express authentication recommended doing authentication this way, so I didn&apos;t question it for a long time.&lt;/p&gt;
&lt;p&gt;On StackOverflow and across the web dev tutorial-o-sphere, session cookies are often portrayed as outdated, a 2000s internet technology. If you search around for tutorials about &quot;how to implement authentication in NodeJS&quot;, many posts imply that we all ditched old-fashioned session cookies when we moved from &quot;traditional&quot; web apps based on Rails, Django, etc to the new school of Vue, Angular, React, and the rest. Numerous blogs claim that JWTs are &quot;more secure&quot;, then proceed to describe an inherently insecure way to use them!&lt;/p&gt;
&lt;p&gt;This is a mistake. JWTs are fantastic for their intended purpose: &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc7519&quot;&gt;&quot;representing claims to be transferred between two parties.&quot;&lt;/a&gt; That&apos;s why we use them in OpenID Connect (OIDC) to delegate authentication.&lt;/p&gt;
&lt;p&gt;This isn&apos;t an anti-JWT article. If you want to present proof of claims between parties, as we do with OAuth and OpenID Connect, then a JWT is the right way to go (though keep an eye on &lt;a href=&quot;https://paseto.io/&quot;&gt;PASETO...&lt;/a&gt;). My point is that, despite what a lot of the internet tells you, JWTs are not appropriate for browser sessions. I&apos;ve tried to make this post accessible to newer developers, but there are plently of links to additional resources if you want to dive deeper.&lt;/p&gt;
&lt;p&gt;My TL;DR: depending on how you implement it, using JWTs for browser sessions is either...&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;inherently insecure (if you store reusable JWTs in &lt;code&gt;localStorage&lt;/code&gt; or anywhere else accessible to JS)&lt;/li&gt;
&lt;li&gt;or is just &quot;session cookies with extra steps&quot; and no advantages if you put your JWT in an &lt;code&gt;HttpOnly&lt;/code&gt; cookie.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;A common dangerous pattern: JWTs in Local Storage&lt;/h2&gt;
&lt;p&gt;Before getting into it, I want to be clear: JWTs and cookies are orthogonal concepts. You can put JWTs in cookies, you can have cookies that have nothing to do with JWTs, you can send JWTs in non-cookie headers or by other means if you have a reason to. JWTs aren&apos;t an alternative to cookies.&lt;/p&gt;
&lt;p&gt;The articles I&apos;m criticizing in this post talk about &quot;JWTs versus cookies&quot; because those articles are instructing developers to use JWTs, generally stored in &lt;code&gt;localStorage&lt;/code&gt; and sent in the &lt;code&gt;Authorization&lt;/code&gt; header, instead of session cookies.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&quot;Do not store session identifiers in local storage as the data is always accessible by JavaScript. Cookies can mitigate this risk using the httpOnly flag.&quot; -&lt;a href=&quot;https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#local-storage&quot;&gt;OWASP&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;The browser is not a trusted client&lt;/em&gt;. The browser is a dangerous landscape of end-user-installed browser plugins, and a lot of third-party JS scripts we invited in for analytics, ads, support chat, and so on, often at the behest of marketing/support teams. And on top of that, we have all the npm dependencies of our front-end JS code itself.&lt;/p&gt;
&lt;p&gt;If we put an authentication token in &lt;code&gt;localStorage&lt;/code&gt;, XSS through flawed dependencies or other avenues could mean that every active session in our app gets exfiltrated quite trivially, and we are liable. It is a poor decision to store sensitive data like credentials anywhere accessible to JavaScript in the browser.&lt;/p&gt;
&lt;p&gt;Could we do some sort of &lt;strong&gt;refresh token rotation&lt;/strong&gt; scheme in the browser to get around this? We could make the refresh token act as a one-time token. We could even invalidate the whole token chain if any refresh token is used a second time. That would incur significant costs of statefulness and complexity, but would it at least allow us to have JWTs that are accessible to JavaScript in a secure way, so they cannot be exfiltrated by XSS?&lt;/p&gt;
&lt;p&gt;Nope. A smart XSS attacker can wait until the user is done using the app, take the last refresh token issued, and use it as if they were the legitimate user. Once the real user comes back to the app, their reuse of the refresh token they were last issued will trigger the chain to be invalidated at that point, cutting the XSS attacker out of the loop. But the XSS attacker had access during that whole period of user inactivity, and can repeat the process to obtain a new refresh token when the user becomes inactive again. (&lt;a href=&quot;https://www.youtube.com/watch?v=lEnbi4KClVw&quot;&gt;See Dr. Philippe De Ryck&apos;s excellent webinar on the subject: &quot;The impact of XSS on OAuth 2.0 in SPAs&quot;&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;Another approach to thwart XSS is to attempt to &lt;em&gt;hide&lt;/em&gt; the token. &lt;a href=&quot;https://auth0.com/docs/secure/security-guidance/data-security/token-storage#browser-in-memory-scenarios&quot;&gt;Auth0 recommends storing tokens in browser memory*&lt;/a&gt; using Web Workers, and Auth0&apos;s SPA SDK takes this approach by default. There are two problems with this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Storing the token in-memory means it is gone when the user closes the tab or navigates away from your website, so if this is the way you&apos;re doing sessions, your users will have to log in every time they open your website. Unless you&apos;re making a banking application, forcing users to log in so often is generally an unacceptable user experience. (To make logins persist, developers commonly store the token in &lt;code&gt;localStorage&lt;/code&gt;, as Auth0 suggests* for persistence, noting the XSS vulnerability.)&lt;/li&gt;
&lt;li&gt;Even though it&apos;s hidden in a sandboxed Web Worker context, an XSS attack can still inject code into the sites where the main context interacts with the Web Worker, and ultimately obtain the JWT. &lt;a href=&quot;https://pragmaticwebsecurity.com/articles/oauthoidc/localstorage-xss&quot;&gt;This article by Dr. De Ryck&lt;/a&gt; demonstrates such an attack.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;*&lt;/strong&gt; &lt;em&gt;Please note that the Auth0 suggestions I&apos;m citing about token storage are concerning OAuth 2.0 tokens, and not JWTs for sessions between a SPA and its backend HTTP API. Auth0 states that your SPA should only use OAuth 2.0 tokens if it calls multiple APIs that reside in a different domain. I&apos;m just bringing up Auth0&apos;s suggestions to try and build a steel-man case of how to best secure our session JWTs. See &quot;What Auth0 actually recommends for SPAs&quot; below.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Hiding the token in a JS closure has similar weaknesses.&lt;/p&gt;
&lt;p&gt;Ultimately, you cannot hide anything that is accessible to your JS from malicious XSS JS. If you get XSS, and have your authentication token in localStorage or in memory (or in a non-&lt;code&gt;HttpOnly&lt;/code&gt; cookie), it&apos;s game over.&lt;/p&gt;
&lt;p&gt;Some readers might think &quot;but I&apos;m already screwed if I have XSS! Who cares if the XSS has direct access to my authentication data or not?&quot;. That&apos;s true, XSS is very bad. After following all best practices to prevent XSS, I&apos;d argue you should still take the limited means available to you to mitigate what power XSS has in your application. With an &lt;code&gt;HttpOnly&lt;/code&gt; cookie, a successful XSS attacker can still make requests impersonating the user, relying on the browser to send the cookie in requests to your backend server. The difference with an &lt;code&gt;HttpOnly&lt;/code&gt; session cookie versus a JWT in &lt;code&gt;localStorage&lt;/code&gt; is that with the cookie, the attacker can&apos;t exfiltrate the credentials because the browser won&apos;t send the cookie elsewhere. It&apos;s not a huge win, but it is still a win.&lt;/p&gt;
&lt;p&gt;(And okay, okay, they can exfiltrate it with XSS if they control a subdomain &lt;strong&gt;and&lt;/strong&gt; if the cookie has &lt;code&gt;Domain&lt;/code&gt; set to the apex domain... but credentials in &lt;code&gt;localStorage&lt;/code&gt; can be exfiltrated with XSS no matter what.)&lt;/p&gt;
&lt;p&gt;You could submit the JWT in an &lt;code&gt;HttpOnly&lt;/code&gt; cookie, which might seem to be the best of both worlds... until you come up against invalidation.&lt;/p&gt;
&lt;h2&gt;&quot;Stateless&quot; JWTs for sessions: The Problem of Invalidation&lt;/h2&gt;
&lt;p&gt;Software land is bedecked with dreams of stateless, even serverless applications. Part of why JWTs are supposed to be so cool is because they enable a user authentication without stateful sessions. A &lt;strong&gt;stateless JWT&lt;/strong&gt; contains session data coded directly into the token. The name is maybe confusing if you&apos;re looking at it from the JWT&apos;s point of view, because a stateless JWT does hold state. But it&apos;s named this way because putting state in the stateless JWT enables the &lt;em&gt;server&lt;/em&gt; to be stateless with regards to sessions.&lt;/p&gt;
&lt;p&gt;Using a JWT to authenticate sessions seems at first like a great solution. A user makes a request to an endpoint of our HTTP server with the header &lt;code&gt;Authorization: Bearer &amp;#x3C;jwt-here&gt;&lt;/code&gt;. We merely have to verify the JWT&apos;s integrity, and then we can trust all the claims of the token. We can then achieve a broad set of functionality without ever having to hit the database to get any data supplied by the token. This is performant, and pleasingly stateless.&lt;/p&gt;
&lt;p&gt;However, because we&apos;ve avoided stateful sessions, we have run into the problem of &lt;strong&gt;stale JWTs&lt;/strong&gt;. What if someone left their session open on a public computer, or had their device stolen, and wants to log out all their sessions? Or, what if we want to revoke a user&apos;s permissions after they leave an organization?&lt;/p&gt;
&lt;p&gt;We need a way to &lt;strong&gt;invalidate&lt;/strong&gt; these stateless JWTs. The only way to do this is through blocklisting JWTs (or some variation of that). This means each time our server looks at the stateless JWT, it has to access our stateful JWT blocklist/allowlist/etc to make sure our application hasn&apos;t invalidated the token. The statelessness is gone. So we might as well have used stateful sessions!&lt;/p&gt;
&lt;p&gt;Blocklists aren&apos;t the only way to do invalidation. JWTs have expiration built in (&lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc7519#section-4.1.4&quot;&gt;the &lt;code&gt;exp&lt;/code&gt; claim&lt;/a&gt;). So we could make the tokens expire quickly, let&apos;s say every 5 minutes, and just keep re-issuing them. We don&apos;t want users to have to re-login every 5 minutes, so we can issue a user one long-lived &lt;strong&gt;refresh token&lt;/strong&gt; that we use to fetch a new short-lived access token. The short-lived token has all the user-associated data which we don&apos;t want to get stale, including authentication data, possibly authorization data &lt;code&gt;allowedResources: [&quot;someOrganizationA&quot;]&lt;/code&gt; and maybe even user metadata. Instead of needing to hit the database every time our user hits an authenticated route, we only need to do it when they refresh their short-lived token. But you still have stateful sessions, they&apos;re just more database-light. And this approach means accepting a 5 minute staleness, so the admin that just got demoted has that much time to do whatever schenanigans an irate ex-admin does with a stale JWT.&lt;/p&gt;
&lt;p&gt;If you want invalidation (which for sessions, &lt;em&gt;you really do!&lt;/em&gt;), then you need a stateful blocklist/allowlist, which is as much overhead as a database of session tokens.&lt;/p&gt;
&lt;p&gt;The &quot;stateless&quot; promise doesn&apos;t hold up. All this is a lot of work to do something that session cookies do more simply and more securely.&lt;/p&gt;
&lt;h2&gt;Bearer Token: Misappropriation from OAuth 2.0&lt;/h2&gt;
&lt;p&gt;The convention of using the header &lt;code&gt;Authorization: Bearer &amp;#x3C;token&gt;&lt;/code&gt; comes from &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc6750&quot;&gt;an OAuth 2.0 specification&lt;/a&gt;. It&apos;s meant to access OAuth 2.0 protected resources.&lt;/p&gt;
&lt;p&gt;OAuth 2.0 is not meant for sessions between your one frontend browser application to your app&apos;s backend HTTP server. It is a framework to allow an application to obtain limited access to another application on behalf of a &quot;resource owner&quot;, often a human user.&lt;/p&gt;
&lt;p&gt;In the olden times before OAuth, if I wanted to allow a social media app to access my email contacts, I had to give the social media app &lt;em&gt;my username and password to my email&lt;/em&gt; for it to log in as me and check my contexts. Obviously this is a security nightmare! The social media app has my full email login credentials (which I can only hope it&apos;s storing securely). It has the ability to read all my emails, send emails, even lock me out of my account by changing my password!! That&apos;s a huge risk to me the user, and a huge liability for the social media company.&lt;/p&gt;
&lt;p&gt;We needed a way to grant &lt;strong&gt;limited access&lt;/strong&gt; to applications, and thus OAuth 1.0 and eventually 2.0 were born. OAuth allows applications to delegate limited access, so some app can read my contacts or do other limited actions in a way that is transparent to the user and revokable. (PS: &lt;a href=&quot;https://oauth.net/about/introduction/&quot;&gt;this short article about OAuth&apos;s history&lt;/a&gt; is a nice quick summary.)&lt;/p&gt;
&lt;p&gt;But somehow, SPA developers began taking pieces from OAuth out of context and using them for the long-term authentication of browser sessions where there is no third party involved. There are many tutorials out there that suggest using &lt;code&gt;Authorization: Bearer &amp;#x3C;jwt-here&gt;&lt;/code&gt; where a website in a browser is directly authenticating to its backend HTTP server without any OAuth concerns present at all. It doesn&apos;t make sense to do use &lt;code&gt;Authorization: Bearer &amp;#x3C;token&gt;&lt;/code&gt; to do that.&lt;/p&gt;
&lt;h3&gt;HTTP Trivia Corner!&lt;/h3&gt;
&lt;p&gt;The earliest HTTP, retrospectively called 0.9, did not have headers. &lt;code&gt;Authorization: basic-credentials | ( auth-scheme #auth-param )&lt;/code&gt; is one of the original headers from &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc1945#section-11&quot;&gt;HTTP 1.0&lt;/a&gt;, where HTTP headers were first introduced.&lt;/p&gt;
&lt;p&gt;ðŸŒˆðŸŒŸ &lt;strong&gt;&lt;em&gt;NOW YOU KNOW!&lt;/em&gt;&lt;/strong&gt; ðŸŒˆðŸŒŸ&lt;/p&gt;
&lt;h2&gt;Speculations: Where did this JWT-for-sessions trend come from?&lt;/h2&gt;
&lt;p&gt;Stepping away from Auth0, why do so many tutorials out there suggest using JWTs for sessions, particularly with &lt;code&gt;Authorization: Bearer &amp;#x3C;token&gt;&lt;/code&gt; and storing the JWT in &lt;code&gt;localStorage&lt;/code&gt;?&lt;/p&gt;
&lt;p&gt;My armchair theory is that new JS developers get taught to use providers like Auth0 for authentication, in bootcamps or in &quot;how to make an express spa app&quot; tutorials. Their initial training is usually frontend-heavy, and based on using a handful of external third-party APIs perhaps without any backend of their own. Using a third-party auth provider as your first experience implementing authentication kind of misrepresents auth as requiring OIDC and the delegation that entails. Then these developers sloppily borrow concepts from Auth0/OAuth/OIDC to implement their own auth, thinking cookies are outdated and JWTs are the new cool better technology to use after having read a lot of pro-JWT marketing material? I&apos;m not sure.&lt;/p&gt;
&lt;p&gt;Randall Degges, &quot;Chief Hacker&quot; at Okta and former dev advocate at Stormpath, gave the presentation &lt;a href=&quot;https://www.youtube.com/watch?v=pYeekwv3vC4&quot;&gt;&quot;JSON Web Tokens Suck&quot;&lt;/a&gt; at ForwardJS (&lt;a href=&quot;https://speakerdeck.com/rdegges/jwts-suck&quot;&gt;slides&lt;/a&gt;). If you&apos;re reading this far into my post, you would probably get something out of watching it.&lt;/p&gt;
&lt;p&gt;Randall blames himself for the popularity of JWTs, and more specifically Stormpath, Okta, and Auth0:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The security industry is super f***ing boring and slow. Nothing exciting ever happens, like ever. When JSON Web Tokens came around, someone wrote a blog post about the possibility of using them to store session information, it got a bunch of buzz in the security space, and Auth0 and Stormpath started playing around with it.&lt;br&gt;
[...]&lt;br&gt;
We made a lot of money off of promoting JSON Web Tokens. And so at the end of the day, the reason why JSON Web Tokens are so popular today is because over the last 3 years [2015-2018ish] both of our companies strategically used them as a way to market to developers, not based around any sort of like legitimate security concerns, but purely because it&apos;s a valuable marketing ploy in the security industry where this stuff is not happening very often.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;He suggests you validate these claims (JWT pun not intended) by searching google in an incognito tab for JSON web tokens and then noting how many of the top results are marketing pages for services like Auth0 and Stormpath. At the time of this writing Stormpath has been acquired by Okta and competitor Supertokens also has strong SEO here, but, yup. Note also that the most prominent JWT resource &lt;a href=&quot;https://jwt.io/&quot;&gt;https://jwt.io/&lt;/a&gt; is by Auth0/Okta!&lt;/p&gt;
&lt;p&gt;I&apos;m not trying to make the argument that Okta/Auth0/etc are insecure. Whether you use them securely or insecurely is up to you.&lt;/p&gt;
&lt;p&gt;Rather, the problem I&apos;m targeting here is that many developers use JWTs in places where they aren&apos;t appropriate because it&apos;s a self-perpetuating trend and session cookies are wrongly seen as old-fashioned, irrelevant, and insecure. Those companies seem inadvertently somewhat responsible for the trend, but whatever, what I hope you get out of this article is to not a negative impression of these companies, but rather an understanding of why it&apos;s a bad idea to use JWTs for your application&apos;s sessions in a pale imitation of these auth providers.&lt;/p&gt;
&lt;h3&gt;What Auth0 actually recommends for SPAs&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;When the SPA calls only an API that is served from a domain that can share cookies with the domain of the SPA, &lt;strong&gt;no tokens are needed&lt;/strong&gt;. OAuth &lt;strong&gt;adds additional attack vectors without providing any additional value and should be avoided in favor of a traditional cookie-based approach.&lt;/strong&gt; -&lt;a href=&quot;https://auth0.com/docs/secure/security-guidance/data-security/token-storage&quot;&gt;Auth0 &quot;Token Storage&quot; docs (SPA tab)&lt;/a&gt;, emphasis mine.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We can&apos;t really blame services like Auth0. They over-hyped JWTs, but the hype-happy JS community was eager to embrace a new cool thing, and was eager to misunderstand how the concerns of OAuth/OIDC/SSO are different than the concerns of session authentication for a website communicating with an API on a shared domain.&lt;/p&gt;
&lt;p&gt;(However, it would be nice to see less docs quickstarts that say &quot;don&apos;t store the JWT in localStorage, but as an example, we will.&quot;)&lt;/p&gt;
&lt;h1&gt;What&apos;s a Session Cookie?&lt;/h1&gt;
&lt;p&gt;A session cookie is a cookie with a cryptographically secure random string. &lt;a href=&quot;https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#session-id-properties&quot;&gt;OWASP recommends&lt;/a&gt; it&apos;s at least 16 bytes, with 64 bits of entropy. It needs to be implausible to guess, because that random string is the token that authenticates a session.&lt;/p&gt;
&lt;p&gt;(&lt;a href=&quot;https://github.com/expressjs/session/issues/176&quot;&gt;Some session management libraries&lt;/a&gt; force this randomness by signing a given session token with a random string, in order to prevent newbie developers from using session tokens that are easily predictable incrementing integers.)&lt;/p&gt;
&lt;p&gt;When a user authenticates to your server with credentials like their username and password, you check the credentials, then create a random session token and add it to your stateful sessions database so that that new session token is associated with that user. It might be something like a cookie with a value &lt;code&gt;39ur20fu2948fy34fy3fo983u20du83s&lt;/code&gt;, and a corresponding database entry like &lt;code&gt;session_id: 39ur20fu2948fy34fy3fo983u20du83s, user_id: 123, session_expiration: 2024-01-29&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now whenever you receive a request on an authenticated route, you use the session cookie&apos;s value to query the database where you&apos;re storing your session data, and if there&apos;s a matching non-expired session, you have authentication.&lt;/p&gt;
&lt;p&gt;To invalidate a session, remove it from your database or otherwise mark it as invalid. This is the same as you&apos;d need to implement JWT invalidation, but without all the extra steps and additional security hazards inherent to JWTs.&lt;/p&gt;
&lt;h2&gt;Cookie Attributes to Know&lt;/h2&gt;
&lt;p&gt;I already discussed &lt;code&gt;HttpOnly&lt;/code&gt; (which prevents JavaScript from reading the cookie) and &lt;code&gt;SameSite&lt;/code&gt; which provides limited protection against CSRF attacks. Another important cookie attribute is &lt;code&gt;Secure&lt;/code&gt;, which restricts the cookie to only be submitted over HTTPS. Whether in a cookie or in an &lt;code&gt;Authorization&lt;/code&gt; header, credentials sent over insecure HTTP can be read by anyone between you and the end server. If an eavesdropper can read your session cookie, or your session JWT for that matter, they can impersonate you for the duration of the session. Hopefully your server only accepts HTTPS, but the &lt;code&gt;Secure&lt;/code&gt; attribute ensures the browser won&apos;t permit sending the cookie in an insecure HTTP context.&lt;/p&gt;
&lt;h1&gt;XSS versus CSRF&lt;/h1&gt;
&lt;p&gt;StackOverflow comments abound with &quot;well actually, if you use a cookie for authentication, that&apos;s vulnerable to CSRF. You should just put a JWT in localStorage. If XSS happens you&apos;re screwed anyway.&quot;&lt;/p&gt;
&lt;p&gt;This idea comes out of a misunderstanding of the risks. I explained above how a properly-configured &lt;code&gt;HttpOnly&lt;/code&gt; cookie can prevent exfiltration of credentials in an XSS attack. If your credentials are accessible to JS, you can&apos;t prevent exfiltration in an XSS attack. That&apos;s a win for the session cookie in the XSS arena, but what about CSRF? In this section I&apos;ll talk about why CSRF is a solvable problem.&lt;/p&gt;
&lt;p&gt;CSRF quick summary: CSRF takes advantage of authentication/session cookies to impersonate a user who is currently logged in to an application. Let&apos;s say there&apos;s a vulnerable ecommerce app, InsecureStore. Our victim is logged into InsecureStore via a session cookie. The attacker gets a victim to go to a malicious website, maybe by phishing or by putting a website on a typo domain or anything. On the malicious site, the victim is tricked into submitting a request to &lt;code&gt;insecurestore.com&lt;/code&gt;, let&apos;s say by a hidden form that is triggered automatically by JavaScript on the malicious page. Meanwhile, &lt;code&gt;insecurestore.com&lt;/code&gt; has an endpoint &lt;code&gt;insecurestore.com/gift-card&lt;/code&gt; that takes a &lt;code&gt;POST&lt;/code&gt; with &lt;code&gt;application/x-www-form-urlencoded&lt;/code&gt; (or &lt;code&gt;multipart/form-data&lt;/code&gt; or &lt;code&gt;text/plain&lt;/code&gt;, these media types do not trigger a CORS preflight). The malicious page performs a &lt;code&gt;POST&lt;/code&gt; to that endpoint to buy the attacker a gift card with the victim&apos;s money. Our fictitious &lt;code&gt;insecurestore.com&lt;/code&gt; servers are checking the session cookie in order to authenticate requests, and because the victim&apos;s browser included their &lt;code&gt;insecurestore.com&lt;/code&gt; cookies with that forged request, the servers process the request as if it&apos;s legitimate, and the attack is successful.&lt;/p&gt;
&lt;p&gt;(PS: at the time of this writing, nothing exists on &lt;code&gt;insecurestore.com&lt;/code&gt;. &lt;em&gt;The story, all names, characters, and incidents portrayed in this example are fictitious. No identification with actual persons (living or deceased), places, buildings, and products is intended or should be inferred.&lt;/em&gt; ðŸ™ƒ)&lt;/p&gt;
&lt;p&gt;Some newbie developers (I hope they&apos;re newbies...) in the comments sections of our vast Internet confidently state that the best way to protect against a CSRF attack is to just not use session cookies. As we&apos;ve seen, the alternatives to session cookies are less secure. CSRF is something developers can control by implementing well-known mitigations. See &lt;a href=&quot;https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html&quot;&gt;OWASP&apos;s CSRF Prevention Cheat Sheet&lt;/a&gt; for details on how to prevent CSRF with the Synchronizer Token Pattern (stateful) or the Signed Double-Submit Cookie Pattern (stateless). Though you should use a tried-and-true library and not roll your own, it&apos;s still good to understand the mechanism.&lt;/p&gt;
&lt;p&gt;Note also that an &lt;code&gt;application/json&lt;/code&gt; endpoint isn&apos;t susceptible to the attack described above. Only requests using the three aforementioned media types: &lt;code&gt;application/x-www-form-urlencoded&lt;/code&gt;, &lt;code&gt;multipart/form-data&lt;/code&gt;, and &lt;code&gt;text/plain&lt;/code&gt; may avoid triggering a CORS preflight (&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS&quot;&gt;other conditions&lt;/a&gt; also need to be met). In a modern SPA, where you&apos;re making JSON requests to a RESTful HTTP server and never using traditional HTML form submission, a lot of the venues of CSRF are already closed off.&lt;/p&gt;
&lt;p&gt;You &lt;strong&gt;should not rely on these inherent partial protections to mitigate CSRF, and should use one of the methods OWASP prescribes,&lt;/strong&gt; but I think it&apos;s notable that CSRF is tricky to exploit for an HTTP backend that doesn&apos;t use HTML form media types. Here are some vulnerabilities that may allow CSRF even in a purely no-forms, all-JSON HTTP server:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Maybe your server&apos;s framework will accept &lt;code&gt;text/plain&lt;/code&gt; or the other 2 &quot;simple request&quot; candidate media types, autoconverting them to JSON internally. Then the CSRF attack will go through without CORS stopping it.&lt;/li&gt;
&lt;li&gt;Maybe you have an overly-permissive CORS policy: perhaps your &lt;code&gt;Access-Control-Allow-Origin&lt;/code&gt; header is dynamically updated to whatever the requester&apos;s Origin is, and your &lt;code&gt;Access-Control-Allow-Credentials&lt;/code&gt; is always &lt;code&gt;true&lt;/code&gt;. So even an &lt;code&gt;application/json&lt;/code&gt; request with the &lt;code&gt;DELETE&lt;/code&gt; method could go through cross-origin, with the cookie included, because your CORS policy gave the victim&apos;s browser permission to do so.&lt;/li&gt;
&lt;li&gt;Maybe none of these are true... until you update something on your server one day, and don&apos;t notice the change.&lt;/li&gt;
&lt;li&gt;Maybe the user has some plugin which opens up a security hole because of an overly permissive cross-origin policy within the plugin (like Flash), exposing CSRF vectors you don&apos;t expect.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(Examples from &lt;a href=&quot;https://www.directdefense.com/csrf-in-the-age-of-json/&quot;&gt;https://www.directdefense.com/csrf-in-the-age-of-json/&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;SameSite&lt;/code&gt; attribute on your session cookie (which is &lt;code&gt;SameSite=Lax&lt;/code&gt; by default) will also partially protect you from CSRF, by preventing the browser from sending the cookie cross-site. However, there can be cases where &lt;code&gt;Lax&lt;/code&gt; or even &lt;code&gt;Strict&lt;/code&gt; won&apos;t protect you: if an attacker controls any of your subdomains, or if you have &lt;code&gt;Lax&lt;/code&gt; and have stateful &lt;code&gt;GET&lt;/code&gt; endpoints, or if you expose a client-side redirect that can be exploited. &lt;a href=&quot;https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions&quot;&gt;This PortSwigger article&lt;/a&gt; for more info about potential holes in &lt;code&gt;SameSite&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;So please do use CSRF mitigation along with your session cookies, even though a JSON HTTP backend makes it substantially trickier for a CSRF attack to be successful than it was for traditional HTML-form-based backends of the past.&lt;/p&gt;
&lt;p&gt;Follow the OWASP guidelines, using a battle-tested library for Signed Double-Submit Cookies or Synchronizer Token, and your session cookie will be secure against CSRF.&lt;/p&gt;
&lt;h1&gt;What about stateless cookies?&lt;/h1&gt;
&lt;p&gt;Stateless cookies are implemented in a few ways: they might be cookies containing JWTs, or in some other format with no JWTs involved, usually with some library-specific signing and often encryption.&lt;/p&gt;
&lt;p&gt;This turns out to be quite similar to &lt;code&gt;Authorization: Bearer &amp;#x3C;jwt&gt;&lt;/code&gt;, with the differences:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PRO: Ability to use &lt;code&gt;HttpOnly&lt;/code&gt; to make the credentials inaccessible to JavaScript.&lt;/li&gt;
&lt;li&gt;CON: You need to be mindful of the 4kB max size limit of cookies.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Overall, we have the same invalidation and staleness problems with stateless cookies as we do with stateless JWTs sent in a header. &quot;Stateless&quot; sessions mean using a client-side token as a cache for session state. That opens us up to stale session state and takes away our ability to invalidate that session.&lt;/p&gt;
&lt;p&gt;For example, in the stateless cookie library &lt;a href=&quot;https://github.com/vvo/iron-session?tab=readme-ov-file#faq&quot;&gt;iron-session&lt;/a&gt;, the FAQ explains:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;How to invalidate sessions?&lt;/strong&gt;&lt;br&gt;
Sessions cannot be instantly invalidated (or &quot;disconnect this customer&quot;) as there is typically no state stored about sessions on the server by default. However, in most applications, the first step upon receiving an authenticated request is to validate the user and their permissions in the database. So, to easily disconnect customers (or invalidate sessions), you can add an &lt;code&gt;isBlocked&lt;/code&gt; state in the database and create a UI to block customers.&lt;/p&gt;
&lt;p&gt;Then, every time a request is received that involves reading or altering sensitive data, make sure to check this flag.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We have &quot;stateless sessions,&quot; but our first step is to query the database to access server-side session state and verify that the &quot;stateless&quot; session&apos;s content is still current. It&apos;s stateful sessions with extra steps, and the addition of those extra steps is a security liability. If we ever skip the step to verify with the database, we&apos;ll have quietly created a hole in our authentication security.&lt;/p&gt;
&lt;h1&gt;Other JWT Security Concerns&lt;/h1&gt;
&lt;p&gt;This post is already very long and dense, but after describing perhaps too many details about CSRF defense for cookies, I don&apos;t want it to seem like the only security flaws of JWTs are vulnerability to exfiltration by XSS.&lt;/p&gt;
&lt;p&gt;The fact that JWTs are only possible to invalidate through some stateful blocklist implementation is a scary thing. If your blocklist is permissive or slow to update, then compromised credentials cannot be revoked, and claims to authorization privileges in the JWT cannot be revoked. Your team will constantly be fighting temptation to allow holes in the blocklist: if it&apos;s too slow or unavailable, we don&apos;t want login to break for the &quot;edge case&quot; of invalidation, let&apos;s have it fail open! After all, we&apos;re validating the claims that our own servers signed, who cares if they&apos;re a little stale? We can give the appearance of logout by deleting the JWT on the client side.&lt;/p&gt;
&lt;p&gt;If you are really motivated to use JWTs for sessions because you&apos;re struggling to scale your authentication infrastructure, the temptation to lean away from token invalidation will be even stronger.&lt;/p&gt;
&lt;p&gt;The JWT spec is also rather permissive, and so JWT libraries must accept that permissivity. Any &lt;a href=&quot;https://portswigger.net/web-security/jwt&quot;&gt;good introductory resource about JWT security&lt;/a&gt; will mention the &lt;code&gt;&quot;none&quot;&lt;/code&gt; algorithm: an attacker can create a JWT with whatever claims they want: &lt;code&gt;{user: popularCewebrityInfluencer, admin: true}&lt;/code&gt; and set the &lt;code&gt;alg: none&lt;/code&gt;. If the backend developers made the common mistake of using whatever algorithm is specified in the JWT as the source of truth about how to verify it, the backend will see &lt;code&gt;alg: none&lt;/code&gt; (which means &quot;don&apos;t worry about it&quot;) and treat all claims in the token as valid. The attacker can literally write their own ticket.&lt;/p&gt;
&lt;p&gt;You might think &quot;well that&apos;s a rookie mistake, nobody serious ever ran into that.&quot; But, &lt;strong&gt;Auth0 themselves,&lt;/strong&gt; the number-one JWT evangelists of all time, had an &lt;code&gt;alg: nonE&lt;/code&gt; bypass in their Authentication API (the capital &lt;code&gt;E&lt;/code&gt; is what cracked it). See the disclosure &lt;a href=&quot;https://cybercx.co.nz/blog/json-web-token-validation-bypass-in-auth0-authentication-api/&quot;&gt;here&lt;/a&gt;. Again, I don&apos;t mean to pick on Auth0. IMO, this is a flaw in the JWT spec. It arguably shouldn&apos;t allow a &lt;code&gt;none&lt;/code&gt; algorithm, must less require it as one of the two required algorithms!&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Of the signature and MAC algorithms specified in JSON Web Algorithms [JWA], &lt;strong&gt;only HMAC SHA-256 (&quot;HS256&quot;) and &quot;none&quot; MUST be implemented&lt;/strong&gt; by conforming JWT implementations. It is RECOMMENDED that implementations also support RSASSA-PKCS1-v1_5 with the SHA-256 hash algorithm (&quot;RS256&quot;) and ECDSA using the P-256 curve and the SHA-256 hash algorithm (&quot;ES256&quot;). Support for other algorithms and key sizes is OPTIONAL. -(JWT RFC 7519)[&lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc7519#section-8&quot;&gt;https://datatracker.ietf.org/doc/html/rfc7519#section-8&lt;/a&gt;], emphasis mine.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;It seems like a weird choice.&lt;/p&gt;
&lt;p&gt;There are also numerous security flaws that researchers have found in JWT libraries, owing to the inherent complexity of JWTs. Towards the end of &lt;a href=&quot;https://research.securitum.com/jwt-json-web-token-security/&quot;&gt;this article from Securitum&lt;/a&gt; is a list of CVEs and GitHub issues from libraries.&lt;/p&gt;
&lt;p&gt;JWTs are very complex, and offer many opportunities for security-botching mis-implementations and misconfigurations. Security is rarely simple and session cookies still allow developers to build insecure applications, but they&apos;re simpler than JWTs.&lt;/p&gt;
&lt;h1&gt;Thanks for reading!&lt;/h1&gt;
&lt;p&gt;This was a dense one! I hope you got something out of it. Please reach out if you have comments or corrections.&lt;/p&gt;
&lt;h1&gt;Further Reading&lt;/h1&gt;
&lt;p&gt;There are already a couple dozen links in this article, but here are some more!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://portswigger.net/web-security/jwt&quot;&gt;PortSwigger: JWT Attacks&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://redis.com/docs/json-web-tokens-jwts-are-not-safe/&quot;&gt;Redis: JSON Web Tokens are Not Safe (e-book)&lt;/a&gt;. Obviously Redis has a vested interest: &quot;don&apos;t use JWTs, use session cookies instead, with the session tokens stored in Redis.&quot; But that is a robust and secure solution that I endorse, so I&apos;m down to share their content marketing ebook.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=lEnbi4KClVw&quot;&gt;The impact of XSS on OAuth 2.0 in SPAs - webinar by Dr. Philippe De Ryck&lt;/a&gt;. I&apos;m not talking about actual OAuth in my post, but the same points this webinar raises are just as relevant to &quot;using a JWT for session authentication in a pale imitation of OAuth&quot; implementations.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.directdefense.com/csrf-in-the-age-of-json/&quot;&gt;Direct Defense: CSRF in the Age of JSON&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.rdegges.com/2018/please-stop-using-local-storage/&quot;&gt;Randall Degges: Please Stop Using Local Storage&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/&quot;&gt;Auth0: Critical vulnerabilities in JSON Web Token libraries&lt;/a&gt; lists vulnerabilities discovered in various JWT libraries. This post was originally written several years before &lt;a href=&quot;https://cybercx.co.nz/blog/json-web-token-validation-bypass-in-auth0-authentication-api/&quot;&gt;Ben Knight&lt;/a&gt; found that Auth0 themselves were vulnerable to a &lt;code&gt;alg: nonE&lt;/code&gt; signature exclusion attack.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://cryto.net/~joepie91/blog/2016/06/13/stop-using-jwt-for-sessions/&quot;&gt;joepie91&apos;s Ramblings - Stop using JWT for sessions&lt;/a&gt; and part 2 with a &lt;a href=&quot;http://cryto.net/~joepie91/blog/2016/06/19/stop-using-jwt-for-sessions-part-2-why-your-solution-doesnt-work/&quot;&gt;fun, &quot;slightly sarcastic&quot; flowchart&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Deploying Flask Apps Easily with Docker and Nginx]]></title><link>https://ianlondon.github.io/posts/deploy-flask-docker-nginx</link><guid isPermaLink="false">deploy-flask-docker-nginx</guid><pubDate>Sat, 01 Oct 2016 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;IMPORTANT NOTE!&lt;/h1&gt;
&lt;p&gt;This is a tutorial intended for beginners who want to learn by messing around and DIY-ing, which is a great way to learn.&lt;/p&gt;
&lt;p&gt;However, this is &lt;strong&gt;NOT SECURE&lt;/strong&gt; and &lt;strong&gt;NOT MEANT FOR PRODUCTION&lt;/strong&gt;!&lt;/p&gt;
&lt;p&gt;It&apos;s fun though, and suitable for a hackathon or short-lived personal project where you just want to get something deployed in a manual way that gives you a lot of control.&lt;/p&gt;
&lt;h1&gt;Why use Apache or Nginx for Flask?&lt;/h1&gt;
&lt;p&gt;You can simply configure your Flask app to run with the line &lt;code&gt;app.run(host=&quot;0.0.0.0&quot;, port=80)&lt;/code&gt; at the end, and get your app running online without using Apache2 by just doing &lt;code&gt;python myapp.py&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;There are 3 disadvantages of doing this - 1 big and 2 little:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The main limitation of relying on &lt;code&gt;app.run()&lt;/code&gt; is that it uses Flask&apos;s built-in server, which was built for local development and not for use in production. It cannot handle much traffic and isn&apos;t very robust. Apache and Nginx are battle-tested, high quality, robust web servers that are very widely used in production.&lt;/li&gt;
&lt;li&gt;If you run &lt;code&gt;python myapp.py&lt;/code&gt; in an ssh session, your app will close when you close your ssh connection. You can get around this by running it in something like &lt;code&gt;tmux&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;If your server reboots, the app will not start unless you ssh in again and restart it. One way to fix this is by making an upstart job to start the app, but again, you are still using Flask&apos;s little development server.&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;Is there an easier way?&lt;/h1&gt;
&lt;p&gt;I was writing a tutorial for the students of &lt;a href=&quot;http://www.thisismetis.com&quot;&gt;Metis&apos;s Data Science Bootcamp&lt;/a&gt; about deploying Flask apps on Linux servers. That tutorial focused on setting up Apache server and mod_wsgi. Several pages in, I decided to change direction. Apache is a huge pain to configure for developers who just want to get something running. Between Flask, Python virtual environments, mod_wsgi, Apache, and the Linux server itself, there are way too many points of failure for a simple tutorial. You wind up needing to know many different ways to debug different components, and you need to check several logs to trace down errors (if they&apos;re logged at all). It is simply not simple! Nginx, one of the leading alternative web servers for Flask apps, isn&apos;t too easy to set up on a bare machine either (but &lt;a href=&quot;https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-uwsgi-and-nginx-on-ubuntu-14-04&quot;&gt;here&apos;s a good tutorial&lt;/a&gt; if you&apos;re interested).&lt;/p&gt;
&lt;p&gt;At the same time, I have been learning about using Docker to speed up the process of getting development and production environments up and running in a portable way. I came across a &lt;a href=&quot;https://github.com/tiangolo/uwsgi-nginx-flask-docker&quot;&gt;Docker image with Flask and NGINX set up&lt;/a&gt; and found this to be a really easy way to get a Flask app running on a production web server (ie, not with Flask&apos;s &lt;code&gt;app.run&lt;/code&gt; built-in development server).&lt;/p&gt;
&lt;h1&gt;Let&apos;s start: Launch an EC2 instance&lt;/h1&gt;
&lt;p&gt;First off launch a new EC2 instance using the Ubuntu image. A free-tier &lt;code&gt;t2.micro&lt;/code&gt; will be plenty for this tutorial.&lt;/p&gt;
&lt;p&gt;Make sure inbound traffic on port 80 (HTTP) is open to the world by allowing it in your security group:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c2fb57c1bd1bfb5d798271b2fc8d91c1/9a86a/open_http_security_group.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 24.324324324324326%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAnUlEQVR42pWOyQrDIBRF/f+fq4RmUBye1Bjr0ECzj7kE0k3pomd1uJc3sGVZykmt1ZJ15GbvrbUlF1TPlMoPcs5MSDlfaK2JSCl14xwyjqNzDrn3/vEFciaE8OepGKOUknNujO66jshO03Tve1TDMGBXCOFzBo5BhiKerOuKyBgDxzy+giulU0phDvVVt217X8BxnGExrLW273v7kwO+7BDmKSpqlQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;security settings&quot;
        title=&quot;&quot;
        src=&quot;/static/c2fb57c1bd1bfb5d798271b2fc8d91c1/fcda8/open_http_security_group.png&quot;
        srcset=&quot;/static/c2fb57c1bd1bfb5d798271b2fc8d91c1/12f09/open_http_security_group.png 148w,
/static/c2fb57c1bd1bfb5d798271b2fc8d91c1/e4a3f/open_http_security_group.png 295w,
/static/c2fb57c1bd1bfb5d798271b2fc8d91c1/fcda8/open_http_security_group.png 590w,
/static/c2fb57c1bd1bfb5d798271b2fc8d91c1/9a86a/open_http_security_group.png 792w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ssh&lt;/code&gt; into your EC2 instance. If this is your first time connecting to EC2, follow &lt;a href=&quot;https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html&quot;&gt;this guide&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;Install the prerequisites&lt;/h1&gt;
&lt;p&gt;After &lt;code&gt;ssh&lt;/code&gt;ing into your server, update your packages, then install python, pip, git, and docker. Afterwards, use pip to install virtualenv.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;sudo apt-get update
sudo apt-get install python-dev python-pip git docker.io
sudo pip install virtualenv&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Watch that you install &lt;code&gt;docker.io&lt;/code&gt; and not &lt;code&gt;docker&lt;/code&gt;, they&apos;re different things!&lt;/p&gt;
&lt;h1&gt;Set up your project&lt;/h1&gt;
&lt;p&gt;Even if you are an old hat with Flask, make sure to follow the naming rules and file structure here or things will break.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Make a new empty directory for your project.&lt;/li&gt;
&lt;li&gt;Set up a virtual environment in a directory called &lt;code&gt;venv&lt;/code&gt; with the command &lt;code&gt;virtualenv venv&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Activate the virtual environment with &lt;code&gt;source venv/bin/activate&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Make a file &lt;code&gt;requirements.txt&lt;/code&gt; that has all your dependencies in it. For the simplest flask app, all you need is the line: &lt;code&gt;Flask==0.11.1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Install your dependencies with &lt;code&gt;pip install -r requirements.txt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Make a flask app at &lt;code&gt;app/main.py&lt;/code&gt;. For the Docker image we will use, you need to do two important things:
&lt;ol&gt;
&lt;li&gt;Make sure the app is really called &lt;code&gt;main.py&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Make sure the Flask app variable is really called app. The Flask app variable is declared like &lt;code&gt;app = Flask(..blah blah..)&lt;/code&gt;. If you call this variable something else like &lt;code&gt;my_app = Flask(..blah blah..)&lt;/code&gt;, the Docker image won&apos;t find it and it will not work!&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you have a complex Flask app with many files, that&apos;s fine. Just make sure the file with the line &lt;code&gt;app = Flask(..blah blah..)&lt;/code&gt; is called &lt;code&gt;main.py&lt;/code&gt; and is in the &lt;code&gt;app/&lt;/code&gt; directory.&lt;/p&gt;
&lt;p&gt;Here&apos;s an example Flask app:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;from flask import Flask

# the all-important app variable:
app = Flask(__name__)

@app.route(&amp;quot;/&amp;quot;)
def hello():
    return &amp;quot;Oh, Hello World&amp;quot;

if __name__ == &amp;quot;__main__&amp;quot;:
app.run(host=&amp;#39;0.0.0.0&amp;#39;, debug=True, port=80)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Lastly you can test your app by doing &lt;code&gt;python app/main.py&lt;/code&gt;, then go to the IP of your server and make sure it&apos;s working.&lt;/p&gt;
&lt;p&gt;The project should have the following directory structure. I have a repo set up &lt;a href=&quot;https://github.com/IanLondon/simple_flask_docker&quot;&gt;here&lt;/a&gt; with a working example if it helps.&lt;/p&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;root_project_dir/

  Dockerfile

  requirements.txt

  app/
    main.py

  venv/&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h1&gt;Make a Dockerfile&lt;/h1&gt;
&lt;p&gt;A Dockerfile is a file called &lt;code&gt;Dockerfile&lt;/code&gt; (with no extension - not &lt;code&gt;Dockerfile.txt&lt;/code&gt; or .sh or whatever) which tells Docker how to build an image. You can follow &lt;a href=&quot;https://www.digitalocean.com/community/tutorials/docker-explained-using-dockerfiles-to-automate-building-of-images&quot;&gt;this tutorial&lt;/a&gt;, see &lt;a href=&quot;https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/&quot;&gt;best practices&lt;/a&gt;, or peruse the &lt;a href=&quot;https://docs.docker.com/engine/reference/builder/&quot;&gt;docs&lt;/a&gt; for much more detail... there is a &lt;em&gt;lot&lt;/em&gt; more detail though so I think it&apos;s best to just dive in with the world&apos;s simplest Dockerfile, which is all we need for this project:&lt;/p&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;FROM tiangolo/uwsgi-nginx-flask:flask

COPY ./app /app&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2&gt;What is happening?&lt;/h2&gt;
&lt;h3&gt;FROM&lt;/h3&gt;
&lt;p&gt;This line tells Docker what image to pull from the Docker hub repository (it&apos;s like GitHub for Docker containers). The image specified by FROM is the base of the container we are building. User &lt;code&gt;tiangolo&lt;/code&gt; aka SebastiÃ¡n RamÃ­rez made this convenient image which has python, flask, nginx, and uWSGI (the bridge between Flask and Nginx) as well as some other tools like git installed for us on a Debian OS.&lt;/p&gt;
&lt;p&gt;You can think of a Docker image as a virtual operating system, but with smaller file size and with better efficiency. The &lt;code&gt;tiangolo/uwsgi-nginx-flask:flask&lt;/code&gt; sets up a Debian Jesse &quot;virtual operating system&quot; which can run on our Ubuntu machine, or on pretty much any machine. The settings, installed programs, and even the operating system of our machine doesn&apos;t matter -- Docker makes its own isolated container.&lt;/p&gt;
&lt;h3&gt;COPY&lt;/h3&gt;
&lt;p&gt;This is how our app&apos;s code gets incorporated into the Docker container. As you might expect, it copies the &lt;code&gt;app&lt;/code&gt; directory from our project directory to the Docker container&apos;s &lt;code&gt;/app&lt;/code&gt; directory, overwriting the default app that SebastiÃ¡n set up in there with our own.&lt;/p&gt;
&lt;h1&gt;Docker build&lt;/h1&gt;
&lt;p&gt;We are now ready to build our docker container. Make sure you are in the root directory of your project, then do &lt;code&gt;docker build -t my_flask_app .&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This tells Docker to build a container using the project in the present working directory (the &lt;code&gt;.&lt;/code&gt; at the end), and tag it &lt;code&gt;my_flask_app&lt;/code&gt; (&lt;code&gt;-t&lt;/code&gt; stands for &quot;tag&quot;). Docker will pull down the base image &lt;code&gt;tiangolo/uwsgi-nginx-flask:flask&lt;/code&gt; from Docker Hub, then copy our app code into the container.&lt;/p&gt;
&lt;h2&gt;Important note - updating your container with your app!&lt;/h2&gt;
&lt;p&gt;Every time you change your app code, you need to build the container again! If your Dockerfile is arranged correctly, the build should only take a few seconds.&lt;/p&gt;
&lt;h1&gt;Docker run&lt;/h1&gt;
&lt;p&gt;Now we&apos;re ready to run! Assuming you tagged the container as &lt;code&gt;my_flask_app&lt;/code&gt; like I did above, run it with:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;docker run -p 80:80 -t my_flask_app&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-p&lt;/code&gt; connects port 80 of the Docker container to port 80 of your machine, so HTTP can work.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;-t&lt;/code&gt; again specifies the tag of the container we want to run.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Your flask app should now be running - go to your server&apos;s IP address in your browser.&lt;/p&gt;
&lt;p&gt;If you get an error like &quot;address already in use&quot; or &quot;port 80 already in use&quot;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Make sure your Flask app or another app isn&apos;t already running and using port 80&lt;/li&gt;
&lt;li&gt;Sometimes docker doesn&apos;t unbind ports after you close containers, so try &lt;code&gt;sudo service docker restart&lt;/code&gt; then run your container again.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;You can kill the container with &lt;kbd&gt;CTRL + C&lt;/kbd&gt;. Notice that if you go to your server&apos;s IP in your browser, nothing is there.&lt;/p&gt;
&lt;h1&gt;Running persistently&lt;/h1&gt;
&lt;p&gt;We probably want our app to run in the background, and to restart automatically if our server machine is restarted. So we&apos;ll add a few things to our &lt;code&gt;docker run&lt;/code&gt; command:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;docker run -d --restart=always -p 80:80 -t my_flask_app&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-d&lt;/code&gt; runs the Docker container as a daemon in the background&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--restart=always&lt;/code&gt; restarts the container if it crashes, or if the system docker is running on is rebooted.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There we go!&lt;/p&gt;
&lt;h1&gt;Dealing with Daemons&lt;/h1&gt;
&lt;p&gt;We can see what Docker containers are actively running with &lt;code&gt;docker ps&lt;/code&gt;. The output will look like:&lt;/p&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                         NAMES
9905adc26eb4        flask_test:latest   &amp;quot;/usr/bin/supervisor   About an hour ago   Up About an hour    0.0.0.0:80-&amp;gt;80/tcp, 443/tcp   sleepy_yalow&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;If we want to kill the container, use &lt;code&gt;docker kill sleepy_yalow&lt;/code&gt; where &quot;sleepy_yalow&quot; is the container name.&lt;/p&gt;
&lt;h1&gt;PART 2: A more complex Flask app with dependencies &amp;#x26; environmental variables&lt;/h1&gt;
&lt;p&gt;Notice that we made a requirements.txt file, but we didn&apos;t really need it because the Flask module is already included in the base Docker image that we&apos;re using.&lt;/p&gt;
&lt;p&gt;Let&apos;s try a slightly more complex Flask app which uses &lt;a href=&quot;https://github.com/pwaller/pyfiglet&quot;&gt;pyfiglet&lt;/a&gt; to make a ASCII art version of &quot;hello world&quot;. Now we have to actually deal the pyfiglet dependency!&lt;/p&gt;
&lt;h3&gt;New &lt;code&gt;requirements.txt&lt;/code&gt;:&lt;/h3&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Flask==0.11.1
pyfiglet==0.7.5&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3&gt;New Flask app &lt;code&gt;app/main.py&lt;/code&gt;:&lt;/h3&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;from pyfiglet import Figlet
import os
from flask import Flask

app = Flask(__name__)

font = Figlet(font=&amp;quot;starwars&amp;quot;)

@app.route(&amp;quot;/&amp;quot;)
def main():
    # get the message from the environmental variable $MESSAGE
    # or fall back to the string &amp;quot;no message specified&amp;quot;
    message = os.getenv(&amp;quot;MESSAGE&amp;quot;, &amp;quot;no message specified&amp;quot;)

    # render plain text nicely in HTML
    html_text = font.renderText(message)\
            .replace(&amp;quot; &amp;quot;,&amp;quot;&amp;amp;nbsp;&amp;quot;)\
            .replace(&amp;quot;&amp;gt;&amp;quot;,&amp;quot;&amp;amp;gt;&amp;quot;)\
            .replace(&amp;quot;&amp;lt;&amp;quot;,&amp;quot;&amp;amp;lt;&amp;quot;)\
            .replace(&amp;quot;\n&amp;quot;,&amp;quot;&amp;lt;br&amp;gt;&amp;quot;)

    # use a monospace font so everything lines up as expected
    return &amp;quot;&amp;lt;html&amp;gt;&amp;lt;body style=&amp;#39;font-family: mono;&amp;#39;&amp;gt;&amp;quot; + html_text + &amp;quot;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;quot;

if __name__ == &amp;quot;__main__&amp;quot;:
    app.run(host=&amp;quot;0.0.0.0&amp;quot;, port=80)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3&gt;New Dockerfile&lt;/h3&gt;
&lt;p&gt;We also need a new Dockerfile which will use our requirements.txt file to install the packages we need.&lt;/p&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;FROM tiangolo/uwsgi-nginx-flask:flask

# copy over our requirements.txt file
COPY requirements.txt /tmp/

# upgrade pip and install required python packages
RUN pip install -U pip
RUN pip install -r /tmp/requirements.txt

# copy over our app code
COPY ./app /app

# set an environmental variable, MESSAGE,
# which the app will use and display
ENV MESSAGE &amp;quot;hello from Docker&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3&gt;Build and run!&lt;/h3&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;docker build -t flask_ascii .
docker run -p 80:80 -t flask_ascii&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;You should see:&lt;/p&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;__    __   _______  __       __        ______
|  |  |  | |   ____||  |     |  |      /  __  \
|  |__|  | |  |__   |  |     |  |     |  |  |  |
|   __   | |   __|  |  |     |  |     |  |  |  |
|  |  |  | |  |____ |  `----.|  `----.|  `--&amp;#39;  |
|__|  |__| |_______||_______||_______| \______/

_______ .______        ______   .___  ___.
|   ____||   _  \      /  __  \  |   \/   |
|  |__   |  |_)  |    |  |  |  | |  \  /  |
|   __|  |      /     |  |  |  | |  |\/|  |
|  |     |  |\  \----.|  `--&amp;#39;  | |  |  |  |
|__|     | _| `._____| \______/  |__|  |__|

_______   ______     ______  __  ___  _______ .______
|       \ /  __  \   /      ||  |/  / |   ____||   _  \
|  .--.  |  |  |  | |  ,----&amp;#39;|  &amp;#39;  /  |  |__   |  |_)  |
|  |  |  |  |  |  | |  |     |    &amp;lt;   |   __|  |      /
|  &amp;#39;--&amp;#39;  |  `--&amp;#39;  | |  `----.|  .  \  |  |____ |  |\  \----.
|_______/ \______/   \______||__|\__\ |_______|| _| `._____|

&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2&gt;Using a different environmental variable&lt;/h2&gt;
&lt;p&gt;You can overwrite many of the commands specified in the Dockerfile, including the environment variables. To change the $MESSAGE var to something else, use the &lt;code&gt;-e&lt;/code&gt; flag (for &quot;Environment&quot;):&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;docker run -p 80:80 -e MESSAGE=&amp;quot;something else&amp;quot; -t flask_ascii&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h2&gt;Daemonize it!&lt;/h2&gt;
&lt;p&gt;If everything&apos;s working, run it as an auto-restarting daemon:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;bash&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;docker run -d -restart=always -p 80:80 -t flask_ascii&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h1&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;I hope you are now comfortable with the basics of using Docker containers. Another bonus about Docker containers is that they integrate with services like AWS&apos;s Elastic Container Service (ECS), which allows you to set up a group of EC2 instances running your app which can auto-scale based on load and also run under a load balancer to send out traffic evenly across the different instances... but that&apos;s another blog post!&lt;/p&gt;
&lt;p&gt;As always, please reach out with any questions!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Encoding cyclical continuous features - 24-hour time]]></title><link>https://ianlondon.github.io/posts/encoding-cyclical-features-24-hour-time</link><guid isPermaLink="false">encoding-cyclical-features-24-hour-time</guid><pubDate>Sun, 31 Jul 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Some data is inherently cyclical. Time is a rich example of this: minutes, hours, seconds, day of week, week of month, month, season, and so on all follow cycles. Ecological features like tide, astrological features like position in orbit, spatial features like rotation or longitude, visual features like color wheels are all naturally cyclical.&lt;/p&gt;
&lt;p&gt;Our problem is: how can we let our machine learning model know that a feature is cyclical? Let&apos;s explore a simple 24-hour time dataset. The time might be connected to temperature, or exits through a subway turnstile, or anything. But we want to convey its cyclical nature to our model.&lt;/p&gt;
&lt;p&gt;First, we&apos;ll generate some fake times. Since we&apos;re only looking at where the time appears on a 24-hour clock, we can represent the times as seconds past midnight.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;%matplotlib inline
import matplotlib.pyplot as plt
import pandas as pd
import numpy as np&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;def rand_times(n):
    &amp;quot;&amp;quot;&amp;quot;Generate n rows of random 24-hour times (seconds past midnight)&amp;quot;&amp;quot;&amp;quot;
    rand_seconds = np.random.randint(0, 24*60*60, n)
    return pd.DataFrame(data=dict(seconds=rand_seconds))

n_rows = 1000

df = rand_times(n_rows)
# sort for the sake of graphing
df = df.sort_values(&amp;#39;seconds&amp;#39;).reset_index(drop=True)
df.head()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;div&gt;
&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;
  &lt;thead&gt;
    &lt;tr style=&quot;text-align: right;&quot;&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;seconds&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;0&lt;/th&gt;
      &lt;td&gt;192&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;1&lt;/th&gt;
      &lt;td&gt;212&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2&lt;/th&gt;
      &lt;td&gt;299&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;3&lt;/th&gt;
      &lt;td&gt;300&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;4&lt;/th&gt;
      &lt;td&gt;353&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;Seconds past midnight alone conveys no closeness between data that crosses the &quot;split&quot;. Here, the split is at midnight.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;df.seconds.plot();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 398px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d4937fd73b28d399fdcab411a68793f1/692d4/output_4_0.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAABpklEQVR42pWSuW7CQBCGLaUAiyIcIShRLpIoBUlNQ6hoaChSuaCMpXQ0PABdqGhdISFegudIiWQ5MgUNRwy+8LXezMY2GAQEVhrvv7vWt//MDkVRVBript/vM4PB4EMUxXdBEFiY/yKsN9dEC4LIDociy/Mi22xyCWBRyUgkcqfruoC9gfBxwyUfw3Bxr9fLESCh3muaxvs/WBDOvnDdlVYUbMsydkzTQQHwFBxmj3VowbWShLGuew4RQkuHaQA+/gd0Xf8QTsEVns3AnrNKOQyM73MYgLw6ea7IvFnDMDCxCxjAbBvj+dxzhtD2R1kDkkdRVfU7AIZdaZqXHoFuOj7IIeyjoOgEBEVfQrbAdgKhbTwgFBqR1EiKftEP6sMwMBWNRm8Dh5AiOhC0BnTdVWOfxGKxDM+Pv6ZTe67ri5GqyjNNW0xM0xwpiiJB0/8QDZdOyZpowzDGsizPYG9iWdYItNRut18of9DF4ttFt/uZqtVqmXz+NVev1885jkuUSqWnSqWS7XQ6cYZhrguFwnOr1Uo2Go0zoqvV6hU5K5fLDzRNX/4CNABIC8nETbUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;png&quot;
        title=&quot;&quot;
        src=&quot;/static/d4937fd73b28d399fdcab411a68793f1/692d4/output_4_0.png&quot;
        srcset=&quot;/static/d4937fd73b28d399fdcab411a68793f1/12f09/output_4_0.png 148w,
/static/d4937fd73b28d399fdcab411a68793f1/e4a3f/output_4_0.png 295w,
/static/d4937fd73b28d399fdcab411a68793f1/692d4/output_4_0.png 398w&quot;
        sizes=&quot;(max-width: 398px) 100vw, 398px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Notice that the distance between a point as 5 minutes before and 5 minutes after the split is very large. This is undesirable: we want our machine learning model to see that 23:55 and 00:05 are 10 minutes apart, but as it stands, those times will appear to be 23 hours and 50 minutes apart!&lt;/p&gt;
&lt;h1&gt;Transformation into 2 dimensions&lt;/h1&gt;
&lt;p&gt;Here&apos;s the trick: we will create two new features, deriving a sine transform and cosine transform of the seconds-past-midnight feature. We can forget the raw &quot;seconds&quot; column from now on.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;seconds_in_day = 24*60*60

df[&amp;#39;sin_time&amp;#39;] = np.sin(2*np.pi*df.seconds/seconds_in_day)
df[&amp;#39;cos_time&amp;#39;] = np.cos(2*np.pi*df.seconds/seconds_in_day)

df.drop(&amp;#39;seconds&amp;#39;, axis=1, inplace=True)

df.head()&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;div&gt;
&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;
  &lt;thead&gt;
    &lt;tr style=&quot;text-align: right;&quot;&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;sin_time&lt;/th&gt;
      &lt;th&gt;cos_time&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;0&lt;/th&gt;
      &lt;td&gt;0.013962&lt;/td&gt;
      &lt;td&gt;0.999903&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;1&lt;/th&gt;
      &lt;td&gt;0.015416&lt;/td&gt;
      &lt;td&gt;0.999881&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;2&lt;/th&gt;
      &lt;td&gt;0.021742&lt;/td&gt;
      &lt;td&gt;0.999764&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;3&lt;/th&gt;
      &lt;td&gt;0.021815&lt;/td&gt;
      &lt;td&gt;0.999762&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;4&lt;/th&gt;
      &lt;td&gt;0.025668&lt;/td&gt;
      &lt;td&gt;0.999671&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;df.sin_time.plot();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 390px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/facda3edcf5a931678a91f7db0c6fa64/727ba/output_8_0.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAB7klEQVR42o2SPW8aQRCGaVJRWrETokRKIqXB+bKSIqlTgBA/gdrCgs4nCgqaFBZIVC4cIdkKFTqJwhWl/4ClqyhMgc7HFbaxYYG9j73d280OcECCjviVRrvavXn2nZuJRKTy+fzbTqdTME1D0XVDubzUlasrQ9E0QzFNXTEMYxG6rv+7P+z1eoVut5uvVCpR4EXa7XacMSakOKVc+L6YCtbZcbh83+ewEkIG5XL52RSoaVqcUiJsW1CMOSAY52K6IiSY5832IUEB6HlefwE8Pf31nRAqZDKfP7gQlZ8Ph/936Lru0uH1dTuOEBOOI+QlX0sajwXcPb5kVb349PAwdc6l1pJkyeD+8cCTk9/fXDccGLh03XAgQmRwcDAHQpcpZRuB0G34l+vXM+Dt7YrDVqu1R2m4w+AIYyEs6+8zAMJ43d+TwdnZHNhsNr9uAi7LW7oMAkqGRzAmg+PjlZKDwd4EBEG3wWlgfjKZOfS8lZIbjcYeQsiRLpHjOGPLsrDs2ggC9nLGxnJwkW3bE8ex8HBIRnd3ZHRzg61+nyDGKEZoZJZKpRjwnsRisa1isfiyXq9v53K516lU6mO1Wn1eq9V2EonE52w2+0ZV1aeZTOZdOp3+cH5e29nf//lid/fHl6OjwivISyaT76PR6PYfZVNf4taUgaoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;png&quot;
        title=&quot;&quot;
        src=&quot;/static/facda3edcf5a931678a91f7db0c6fa64/727ba/output_8_0.png&quot;
        srcset=&quot;/static/facda3edcf5a931678a91f7db0c6fa64/12f09/output_8_0.png 148w,
/static/facda3edcf5a931678a91f7db0c6fa64/e4a3f/output_8_0.png 295w,
/static/facda3edcf5a931678a91f7db0c6fa64/727ba/output_8_0.png 390w&quot;
        sizes=&quot;(max-width: 390px) 100vw, 390px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Notice that now, 5 minutes before midnight and 5 minutes after is 10 minutes apart, just as we wanted.&lt;/p&gt;
&lt;p&gt;However, with just this sine transformation, you get a weird side-effect. Notice that every horizontal line you draw across the graph touches two points. So from this feature alone, it appears that midnight==noon, 1:15am==10:45am, and so on. There is nothing to break the symmetry across the period. We really need two dimensions for a cyclical feature. Cosine to the rescue!&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;df.cos_time.plot();&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 390px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/32d2fba9e4e143c2b021c49a207bdb63/727ba/output_10_0.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAABzklEQVR42pWTv0/CQBTHWZwYjagYTdTExfiL6KAzAw1xIo7+ASaQMEg6MLAwQcLEQphgIibMjMxMTITEwUAlwYSktuVKaa/0vNdyUklBvfRy7+7e+9z33ev5fLQlEonjVuuV73aF1GAgpHq9XkoQBLu77eU52NT/ud9/51utt0Q+n/cDz9fpdE5N0yQYE2s2s8j/mhMwnepisZjbsYHtdvvUMHQymxEsipZJ93/tluWMikKwYVDDNEa53BxYKpXuDAPDQRZCFlHVv2kDkCgyhVPxGwgpY2zaQEhZkqjxh8zHY0IPd4C6ri+AzWbzEmNHIXw0DaJp62Fw4OcnpOoBrFQqt24gvUvb2UslW5tMCEFoUZQfQFZl238eAffI7tINZrajbgWw0WiEmEIGXKcS1MH9OX4ewHq9frMMZCpZIFuGg0TRGVcCvVJ2VxJ+D9agYK655Qms1WohSZI0qlLSNE1RVRVRBxk6QioaDqeKohjSx8dkPBqpiD4Cmb4MuodU6iPROCTL8iCTyQSBtxEMBjfT6fR+tVoNxOPxw2g0elEoFHbL5fJ2JBK5Siafjh4eXrY47vEkFrs/h/VsNrsXDoeveZ4/gDiO4878fn/gC7u+X0SCvcnGAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;png&quot;
        title=&quot;&quot;
        src=&quot;/static/32d2fba9e4e143c2b021c49a207bdb63/727ba/output_10_0.png&quot;
        srcset=&quot;/static/32d2fba9e4e143c2b021c49a207bdb63/12f09/output_10_0.png 148w,
/static/32d2fba9e4e143c2b021c49a207bdb63/e4a3f/output_10_0.png 295w,
/static/32d2fba9e4e143c2b021c49a207bdb63/727ba/output_10_0.png 390w&quot;
        sizes=&quot;(max-width: 390px) 100vw, 390px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;With an additional out-of-phase feature (cos), the symmetry is broken. Using the two features together, all times can be distinguished from each other.&lt;/p&gt;
&lt;p&gt;An intuitive way to show what we just did is to plot the two-feature transformation in 2D as a 24-hour clock. The distance between two points corresponds to the difference in time as we expect from a 24-hour cycle. (I&apos;m just plotting a subset of the data so we can see the individual points).&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;df.sample(50).plot.scatter(&amp;#39;sin_time&amp;#39;,&amp;#39;cos_time&amp;#39;).set_aspect(&amp;#39;equal&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 289px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ce256c9efdd133e9db30246dc2b1b661/c969a/output_12_0.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 93.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAACtklEQVR42q2US08aURTHh1aFltakbdLUpm2adNGEhGBjQg17dn6BfgjDwp2LtmlcIDSyaDfsWbGCxLhQA5EYigQUkSAdJIPiE+xEeTllHtdzZ+7FQTR20ZOcnPv83f/MOfcyzJUNT05OvguFQh8CgcAo9mAwOHq9rY/Xx6ampswqKRqNDuCYy+U8COyvZlKn05FwpG1BEKCtRdwn8yKY3Gq1OvPz8x97gMVicRYDFUWR0L+bQkTIi4uL4yoQ+vchmJLJ5A8KBMcRtdsiRG3n2dkFOjzk0c7OCZIkpQcIquVwODzeo7BUKrn1Cvf2eJTL7Wu7FM1FUUJHR39QrdaAwzpIlm9Q6Pf7ByEYMpmMj5wqVSo8Wl39TWBK33cKQgegzR6FCwsLPUAGgHMUWK02UaMhdNXpTZa1AZ5vIpY9UTsXF1fAl3a7fVj/yfA50tpa6VZ11JpNAa2vc30KX1sslqcQzfH4r5948vj4XCqXq3cCoVpQOl1Wl+iT8sJqtT7BjUKBVevw4OBcSibLdwKhDBHHnXaTQhU+cDgcjzVgwaOdLILCmloaN/HoIfAlAOz/h8zExMRDCMZsNttNSrl8ijKZSheAE0GTQQ/h+TbUZrM/y7fVYTa7j6rVep9CGYovlSoBRLz5pjidTnypTbQOKVCSZPV24D2RyCYU+qkKxOprtbqqVCayexTCK2PEcXt7e5b+byyEgGXM5rga1GZdbdMx7HQNAMW+q/ffHoeRkRGclGc+n+/T1taWO51Of1tZWfmez+e/RCKRuVQqNbOxsfl1eTni3d3dnY7FYp54PO7mOG56aWnJx7Ls50QiMeNyud7r3lfGAP4IHKu9h8uJjJnAh0j/OZk3EmfIHob0zXqg+oyBD4EPgg/AyUY85vV6zWNjY29sNttbuKav8BxeQ+bpOrzPcAlDrVWvsD3c5QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;png&quot;
        title=&quot;&quot;
        src=&quot;/static/ce256c9efdd133e9db30246dc2b1b661/c969a/output_12_0.png&quot;
        srcset=&quot;/static/ce256c9efdd133e9db30246dc2b1b661/12f09/output_12_0.png 148w,
/static/ce256c9efdd133e9db30246dc2b1b661/c969a/output_12_0.png 289w&quot;
        sizes=&quot;(max-width: 289px) 100vw, 289px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Voila! We can feed the &lt;code&gt;sin_time&lt;/code&gt; and &lt;code&gt;cos_time&lt;/code&gt; features into our machine learning model, and the cyclical nature of 24-hour time will carry over.&lt;/p&gt;
&lt;h2&gt;Further reading:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://stats.stackexchange.com/questions/126230/optimal-construction-of-day-feature-in-neural-networks&quot;&gt;http://stats.stackexchange.com/questions/126230/optimal-construction-of-day-feature-in-neural-networks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://datascience.stackexchange.com/questions/5990/what-is-a-good-way-to-transform-cyclic-ordinal-attributes&quot;&gt;http://datascience.stackexchange.com/questions/5990/what-is-a-good-way-to-transform-cyclic-ordinal-attributes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Data Munging in Pandas - Tricks and Pitfalls]]></title><link>https://ianlondon.github.io/posts/pandas-tricks-and-pitfalls</link><guid isPermaLink="false">pandas-tricks-and-pitfalls</guid><pubDate>Fri, 15 Jul 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Data munging is the least sexiest part of &lt;abbr title=&quot;Data Science&quot;&gt;&quot;the sexiest job of the 21st century&quot;&lt;/abbr&gt;. According to authoritative popular sources like &lt;a href=&quot;https://twitter.com/BigDataBorat&quot;&gt;@BigDataBorat&lt;/a&gt;, data scientists spend 80% of their time cleaning up data. So we need to be really good at it!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 582px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5edc348efee4ed0398eab51b4297c194/7c1cd/big-data-borat.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.054054054054056%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAUlEQVR42oVQW1KEMBDkhn56BC/hlwfwOlZZ5Q18sQFCIAkQXnmwmF0JKwKLYfHXsj9mumq6Z6baubm+enp8oCkDnodiHKLo9DUsy3K+YG0b/y2zNBOtFaHJMI7O/d0tdF9Eo2shZdMa01/0f6Kfzsd+OBy7cZodIRXnYt9q6xWqadsPrXXG2GfXSamEEFofLFGqafYtFyuMMdsiJ7SPRvG7uwujKIBhEKIkyyzBhGKaIIRgiJ5f3zDGOy+wMuDDGJN5nlezC0BZ1XaW5QVjLCYkYzmlCSYJ5zwvyijGaZrZm5aUVcWF9CEcvtdcHJYXhBDgB4RaSwqAZ/rTFtjyH34A0g5If8HeZCkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Big Data Borat: In Data Science, 80% of time spent prepare data, 20% of time spent compain about need for prepare data.&quot;
        title=&quot;&quot;
        src=&quot;/static/5edc348efee4ed0398eab51b4297c194/7c1cd/big-data-borat.png&quot;
        srcset=&quot;/static/5edc348efee4ed0398eab51b4297c194/12f09/big-data-borat.png 148w,
/static/5edc348efee4ed0398eab51b4297c194/e4a3f/big-data-borat.png 295w,
/static/5edc348efee4ed0398eab51b4297c194/7c1cd/big-data-borat.png 582w&quot;
        sizes=&quot;(max-width: 582px) 100vw, 582px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://pandas.pydata.org/&quot;&gt;pandas&lt;/a&gt; is an awesome python library for manipulating any data that fits in a spreadsheet-like format. If you&apos;re familiar with R, it&apos;s the R dataframes concept implemented in Python. Since the goal of data munging in data science is often to generate a matrix to be fed into a machine learning model, &lt;code&gt;pandas&lt;/code&gt; is a valuable tool to data scientists who use python.&lt;/p&gt;
&lt;p&gt;At the beginning of my time at Metis&apos;s Data Science Bootcamp, I decided to learn everything I could about pandas by diving deep into the docs. The docs are good, but there is a very steep learning curve and the syntax can be tricky sometimes. At Metis, I got the nickname &quot;The Panda King&quot; because I helped my fellow students solve their pandas problems. There was even a Slack emoji made (thanks Hannah):&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 460px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/aa42de37157faef340d1df8b2a282e2a/e41a8/panda_king.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAAAAQBAgUD/8QAGAEBAAMBAAAAAAAAAAAAAAAAAwABAgT/2gAMAwEAAhADEAAAAY65fQ0jZXOzsJz8wZT/xAAcEAABBAMBAAAAAAAAAAAAAAACAAEDEhETITL/2gAIAQEAAQUCi9zdDKABqYPiZx2V7VlOLX//xAAXEQEBAQEAAAAAAAAAAAAAAAAAARES/9oACAEDAQE/Aeo1Uf/EABYRAQEBAAAAAAAAAAAAAAAAABEAEP/aAAgBAgEBPwEjf//EAB8QAAEDAwUAAAAAAAAAAAAAAAABERIQIjEyQVFhgf/aAAgBAQAGPwKXZnFLnlsanThRYpEanh//xAAbEAEAAwEBAQEAAAAAAAAAAAABABEhMWFR8P/aAAgBAQABPyE5twF3ybLb9V2UJthraYEoNk/hlEQGUaSnlPCPOR//2gAMAwEAAgADAAAAEPzHfv/EABgRAQADAQAAAAAAAAAAAAAAAAEAECER/9oACAEDAQE/EAOlW5Fk/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQAQIf/aAAgBAgEBPxBb3ATf/8QAHRABAAICAwEBAAAAAAAAAAAAAREhADFBUXGx4f/aAAgBAQABPxAqQUNgRNcixfGA6NtCH9xREh6YiFSB7EQztbfMNUBJIxOkYLYEehbF7IyE2kTkNWrnHBvD65//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;The Slack emoji made by Hannah&quot;
        title=&quot;&quot;
        src=&quot;/static/aa42de37157faef340d1df8b2a282e2a/e41a8/panda_king.jpg&quot;
        srcset=&quot;/static/aa42de37157faef340d1df8b2a282e2a/a80bd/panda_king.jpg 148w,
/static/aa42de37157faef340d1df8b2a282e2a/1c91a/panda_king.jpg 295w,
/static/aa42de37157faef340d1df8b2a282e2a/e41a8/panda_king.jpg 460w&quot;
        sizes=&quot;(max-width: 460px) 100vw, 460px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h1&gt;Tutorial: Pandas Tricks &amp;#x26; Pitfalls&lt;/h1&gt;
&lt;p&gt;I did a workshop for my class at Metis called &quot;Pandas Tricks &amp;#x26; Pitfalls&quot;, and the Jupyter Notebooks are available on GitHub for anyone who wants to go through and learn more about pandas. There are two notebooks: the main notebook, &lt;code&gt;pandas_tricks.ipynb&lt;/code&gt;, which has examples and explanations, and the worksheet notebook &lt;code&gt;pandas_exercises.ipynb&lt;/code&gt; with exercises you can try as you follow along. Please contact me if you find anything confusing or vague. I&apos;m also always open to answer your pandas questions!&lt;/p&gt;
&lt;h2&gt;Start here: &lt;a href=&quot;https://github.com/IanLondon/pandas_tricks&quot;&gt;https://github.com/IanLondon/pandas_tricks&lt;/a&gt;&lt;/h2&gt;
&lt;h2&gt;Covered in Pandas Tricks and Pitfalls:&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Understanding &lt;code&gt;groupby&lt;/code&gt; in pandas&lt;/li&gt;
&lt;li&gt;Working with dates and times&lt;/li&gt;
&lt;li&gt;Binning with &lt;code&gt;resample&lt;/code&gt; and &lt;code&gt;cut&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;MultiIndexing&lt;/li&gt;
&lt;li&gt;Some plotting tricks with &lt;code&gt;matplotlib&lt;/code&gt; and &lt;code&gt;seaborn&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Web Scraping - Discovering Hidden APIs]]></title><link>https://ianlondon.github.io/posts/web-scraping-discovering-hidden-apis</link><guid isPermaLink="false">web-scraping-discovering-hidden-apis</guid><pubDate>Thu, 14 Jul 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I was trying to help someone with a web scraping task today, and stumbled upon an interesting technique to find hidden APIs to scrape data from certain websites. Some sites use frontend frameworks which render dynamic content by loading a JSON or XML file from their backend to populate the user-facing site. I&apos;m going to show you how to find the URL to access that dynamic content so you can easily scrape data from a site, without &lt;code&gt;lxml&lt;/code&gt; or &lt;code&gt;BeautifulSoup&lt;/code&gt; or CSS selectors or XPath. Just nice, simple JSON.&lt;/p&gt;
&lt;p&gt;Airbnb.com uses this kind of framework (specifically &lt;a href=&quot;http://backbonejs.org/&quot;&gt;Backbone&lt;/a&gt; and &lt;a href=&quot;http://handlebarsjs.com/&quot;&gt;Handlebars&lt;/a&gt;, I think??). Let&apos;s go through and find how to access their backend API to scrape data about listings in a given area.&lt;/p&gt;
&lt;p&gt;I stumbled upon the JSON API because I wanted to scrape the latitude and longitude of the pins on their embedded Google Maps map.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7ed165545f3a6ac3e79c5175f3edbff4/951a4/airbnb_map_highlight.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.621621621621614%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACbklEQVR42jWSXUiTURjH38u66OMy9LKrLrsJsiAiKqGrIKTLboICwxsvhCKCLiqSsgLJSrQl0zKtocvvz6bb6yaburlNt3dbr/tyme77892vo9Th/HjgcM6f3/NwpEomg1Yqkc1mKRYKFP5R1TS0ika5XKZarR7Ukri3l0yQyqZIJP/wO+LBpyr4wkHiUYXtqA8pXyxS1iok06kDCqWieJQkk8uSyefY2d0lnc0cnOfyWUIOG6EVK56lcZTVOeZWTLid02y6F/B5TUj7VpoI1Ap5SqkkiUiE3Vic3F6SsrDW8nm0XI6qMNwP3ZIXCC5O8mtigFCvHlf/Z1R5hNDGEqG1KaRCqUKmIAzzRdIieH/9b1NsMYoc6XSGjKjZ1C5ur4zTayMya8Qq21BnR1G/63BuOLEG/EibPwfIu4zYR3XoO1/wtes1hi96unQ9vO9oR54dY358RDAswrwEnBaifW9x2axYBJHebpz9nzA5vAz5k0h9DxrQNV7g3pVTnDl5nNM1h3h0p4FbjU00Nd5lcaiHzrZWul89xeXxEDdPEpsbRrbb8TtlNhxmYv09RGwTrHjcSNcv1lF75DAnjh2lVvDw9jWC9kGetDTzsvU5KxYThgEDz+43Y/wxRGR1Ae+EEYvfj7JuxeVaRjV8JLC+iOqzIZ0/W4ckSdSI0Mc3z7Ez2IJv6gNXL9Vzo/4ydpsdJRSlva2Dd21vSITXWJsZw92nJ/itH2XMQMAyzqZ/ieCmA2l+ZhLjsJFl8zwJxSnszJhHR5iZnkE2TRMW/yy2HWXdsYFryY3bbxez2sIkL+KzTBBclQnHwyhRFTWm8hepy1VuaNtK6gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;I want these pin locations!&quot;
        title=&quot;&quot;
        src=&quot;/static/7ed165545f3a6ac3e79c5175f3edbff4/fcda8/airbnb_map_highlight.png&quot;
        srcset=&quot;/static/7ed165545f3a6ac3e79c5175f3edbff4/12f09/airbnb_map_highlight.png 148w,
/static/7ed165545f3a6ac3e79c5175f3edbff4/e4a3f/airbnb_map_highlight.png 295w,
/static/7ed165545f3a6ac3e79c5175f3edbff4/fcda8/airbnb_map_highlight.png 590w,
/static/7ed165545f3a6ac3e79c5175f3edbff4/efc66/airbnb_map_highlight.png 885w,
/static/7ed165545f3a6ac3e79c5175f3edbff4/c83ae/airbnb_map_highlight.png 1180w,
/static/7ed165545f3a6ac3e79c5175f3edbff4/951a4/airbnb_map_highlight.png 1355w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;I knew that Google Maps API doesn&apos;t store pin locations -- you have to construct the markers with JavaScript in the browser for pins to show up. I briefly looked at the JavaScript sources to see how this worked but found out the .js resources are minified and obfusticated. I quickly looked elsewhere.&lt;/p&gt;
&lt;h1&gt;Watching Network Traffic with Firefox Developer Tools&lt;/h1&gt;
&lt;p&gt;The &lt;strong&gt;Network&lt;/strong&gt; tab in Firefox&apos;s Developer Tools (hit Ctrl+Shift+Q in plain old vanilla Firefox for it to pop up) is a powerful tool that lets you examine all the network traffic generated by the code running on the website you&apos;re viewing.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2b76a721354904ee1e4e2ea9277cc86e/d0c2f/airbnb_network_tab.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 32.43243243243243%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRUlEQVR42h2OS0/CQACE+5v1F3jTlEcRBIrPICICiVcvxsT4SNSDEqMnQSK1tNt2393tbh82fpnMJJM5jMHzjGdZlOogy0SRszyXRVF6oBJfiCCRSMYfX89vi9e583k3X6wmw/n77Qw4jx4wkN1l/QE9HYjJFHRtt92RF1MxGqvRKDruw5MBPR+7dju4uvx9uP9u7NHNDdJuRsNJdDY2hFmTlTo1d+l2le9UaNWKrSayOrOtFm72ioOjvHdYdPbT6xv99KIbLdWymVmXZlXXLAOIGHC+YuXJJBQSJYqmCsTihyuS5lTrsmGlExJBCGWClcZasyxjaWoA5FNMQwDW7tr3APADP3KXyyUnhDOGICKYwAjyOE6USqRMhFBSYoQwRIYPPQhREIaEEEpZqRAFK8fBmJSDMIxKIEL8H8b+I449EPg++APaAzd93YpH8QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Firefox Developer Tools - Network tab&quot;
        title=&quot;&quot;
        src=&quot;/static/2b76a721354904ee1e4e2ea9277cc86e/fcda8/airbnb_network_tab.png&quot;
        srcset=&quot;/static/2b76a721354904ee1e4e2ea9277cc86e/12f09/airbnb_network_tab.png 148w,
/static/2b76a721354904ee1e4e2ea9277cc86e/e4a3f/airbnb_network_tab.png 295w,
/static/2b76a721354904ee1e4e2ea9277cc86e/fcda8/airbnb_network_tab.png 590w,
/static/2b76a721354904ee1e4e2ea9277cc86e/efc66/airbnb_network_tab.png 885w,
/static/2b76a721354904ee1e4e2ea9277cc86e/c83ae/airbnb_network_tab.png 1180w,
/static/2b76a721354904ee1e4e2ea9277cc86e/d0c2f/airbnb_network_tab.png 1362w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;There are quite a few requests to wade through. Since Airbnb has the option &quot;Search as I move the map&quot;, I figured I could clear the Network tab first then move the map so I&apos;d have a much smaller haystack to search through. To clear the saved requests, click the trash can icon:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 173px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/de2e4a131750b2e367950010a3cdd35c/991de/firefox_network_trashcan.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCklEQVR42k1QW4/SUBDu2/5RLz9DH4z+At/MJkYToi/GZBWM62YBV5ZCBFwK3S1taQulLL2d9rTn0nOoAxsT50wm31y+mTmjRGFoLgzJWFUUyW7nrdYIZXmOXdezbcffBGEUc8bCMHQcSPqEkAwhz1szxpTZTHv/7i0TYl/XY/327Esr2IZrP+h0ur3+8NPns/5gzBnVNK192b1o9wpCLNNonXcokMMosk1z32jI01PcbCJCMczFRXa0B80x1OHiILAU2ChO4jgty1IRnOe8wh8+ypOT+vEjiZCoa0aZkJJRGsVpjvP7XZhlOElQVVVCCF5VUkoACnxBvVY7I8179tx6+Yo+eSpVldR1LWUSJ99/wPLq1a9Bt9Pr9keMcaARSjmHDpUihYSVshSVlOUw0/fZYkEEjIXH6UGAwklJcFECOmq1P4rS8N7AGEqJrt8trWWWY3AfcgC2wf2fm/mtYRrmkvGqPkpZYGu5chxHeW2+AJ8UeK4bc/0uSdGRXD+Q4UKmaRsLy9/sYOEHco4S6DgZTxSIICIyKojYU7HPmUyJQEcFAC4VNRE1gP+D0AbuqlxptpdyY5N++zludX9PnXCdVU5M3YS5CXfj4vz65mt72NecFTrE15mYuVGzO1FnujIyAx9xO0D9qaVq1mKDNlm1Ttk/JerUGsxsM0BQtkooZO1tdjmYDXXrL6lXVi2YAi8KAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;trash can icon&quot;
        title=&quot;&quot;
        src=&quot;/static/de2e4a131750b2e367950010a3cdd35c/991de/firefox_network_trashcan.png&quot;
        srcset=&quot;/static/de2e4a131750b2e367950010a3cdd35c/12f09/firefox_network_trashcan.png 148w,
/static/de2e4a131750b2e367950010a3cdd35c/991de/firefox_network_trashcan.png 173w&quot;
        sizes=&quot;(max-width: 173px) 100vw, 173px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Then move the map. Several rows should appear in the network tab. Click the &lt;code&gt;XHR&lt;/code&gt; button to see only XHR events. XHR should be blue, the rest grayed out. XHR stands for XMLHttpRequest, which is what the frontend will use to make an HTTP request to the backend. What we are looking for will probably be a &lt;code&gt;GET&lt;/code&gt;, but it&apos;s possible for it to be something else if the web devs are doing something weird.&lt;/p&gt;
&lt;p&gt;To browse through the data content of each response, click on the row, then a new &quot;details window&quot; will pop up on the right. Click the &lt;code&gt;Response&lt;/code&gt; tab to show the data returned by that network event. Browse around to see if you find anything cool.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/42cd2f8656f91212ee018581e0dcdf63/4352a/airbnb_response_details.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 17.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+UlEQVR42g2Q226CUBBF+f//6UNjb+ktbaJtFaVaEkRsucM5B0G56eo8rGRPVmZnMpZSiiA1mLJAFzkmjqjjEJPl3C1CVtEBLgPnsWcYB1pjqBYLys85ejrDf3znY+mRaI0RZ612Kc4+xw0LNvuMne2yfZtiT78kb4jLmrV4J8jwfmPyUqGbI4d+oJa8nTmsX+Y0jkMrs3WzinhYJzy7OU/Cq6e4/4m4sn0m3xm3wmQZcS3YfsKfPrI3Cf1RQSPXqwwcG7Ye9B1WpQoOQieyayrO3Ym2NQQ7FyMvuIwtVZnTVIo0TXATjR8G0hMzVlqKawajGGTvfGr4B2NjKE5j96UHAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Looking at the response data&quot;
        title=&quot;&quot;
        src=&quot;/static/42cd2f8656f91212ee018581e0dcdf63/fcda8/airbnb_response_details.png&quot;
        srcset=&quot;/static/42cd2f8656f91212ee018581e0dcdf63/12f09/airbnb_response_details.png 148w,
/static/42cd2f8656f91212ee018581e0dcdf63/e4a3f/airbnb_response_details.png 295w,
/static/42cd2f8656f91212ee018581e0dcdf63/fcda8/airbnb_response_details.png 590w,
/static/42cd2f8656f91212ee018581e0dcdf63/efc66/airbnb_response_details.png 885w,
/static/42cd2f8656f91212ee018581e0dcdf63/c83ae/airbnb_response_details.png 1180w,
/static/42cd2f8656f91212ee018581e0dcdf63/4352a/airbnb_response_details.png 1364w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Finally once you find a response with cool data, you need to get its URL so you can make your own request. Right-click the row of the response you want, and select &quot;Copy URL&quot;. Boom!&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/944c0257c851f5783694cbb070e32fb9/153c4/airbnb_copying_url.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAByUlEQVR42h2S3W8SURDF97/WJ32zjeJHxBSpNTXVhKQxauODrV+ItNVq+bAIlmJLoIWF3bJ7L+zu3WXZ/Xnrw8nMJGcmZ86MEYcRySIhCUMSP0Cao/8YVb9xXHrNn8pH+qNTiGICzTlot7no1nE/vaT2ZY/jvSLt0gfaB59pteoYMkkQGuY8YhDPUcBMYzI8p/tzXzefYDoWfelihYpD64LO+RHHnd/sdtp0z+o0z0/oD0/pjZsY4vYdJsvLXEWZyRA8fITK3MXb2aY7NLGEZFqt0bt2HfvWkuYtITc3sHd3MTMPcG/eQN67T5hdQWVzGCr3hCj/FG91HT+3hv9YI7eKLJa4ME2E5xN2/pK+KJAWNuF5gaRYJj5qsFjfQOWfIbN5gpU8YX4NwwwDxoGi63iMPMWlHuDoWsopljlkKgQzpXDjGDuac2WRqzm2Vm7PY/atiKaI8ElxFwuMd60e5cMzaq92qLwt8X2rxI83X6luvady2KB2ZupDDNn+NaDc6DGwBcOpII480sAj0d6nSUqqDzuPIgxLODhiyuXEwXUlrs5nXoDljukPBoiZj5h6OHLGyLIxhc/AGTFzLQi0Lr0hytdfoFiEin9O8/RHwdDWxwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Copying URL&quot;
        title=&quot;&quot;
        src=&quot;/static/944c0257c851f5783694cbb070e32fb9/fcda8/airbnb_copying_url.png&quot;
        srcset=&quot;/static/944c0257c851f5783694cbb070e32fb9/12f09/airbnb_copying_url.png 148w,
/static/944c0257c851f5783694cbb070e32fb9/e4a3f/airbnb_copying_url.png 295w,
/static/944c0257c851f5783694cbb070e32fb9/fcda8/airbnb_copying_url.png 590w,
/static/944c0257c851f5783694cbb070e32fb9/efc66/airbnb_copying_url.png 885w,
/static/944c0257c851f5783694cbb070e32fb9/c83ae/airbnb_copying_url.png 1180w,
/static/944c0257c851f5783694cbb070e32fb9/153c4/airbnb_copying_url.png 1361w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The URL I got looks like this: &lt;a href=&quot;https://www.airbnb.com/search/search_results?page=1&amp;#x26;source=map&amp;#x26;airbnb_plus_only=false&amp;#x26;sw_lat=40.72108459066701&amp;#x26;sw_lng=-74.10145395441896&amp;#x26;ne_lat=40.81249944772398&amp;#x26;ne_lng=-73.88069742365724&amp;#x26;search_by_map=true&amp;#x26;location=Manhattan%2C+New+York%2C+NY%2C+United+States&amp;#x26;checkin=07%2F19%2F2016&amp;#x26;checkout=07%2F21%2F2016&amp;#x26;guests=&amp;#x26;ss_id=4nufl4i6&quot;&gt;https://www.airbnb.com/search/search_results?page=1&amp;#x26;source=map&amp;#x26;airbnb_plus_only=false&amp;#x26;sw_lat=40.72108459066701&amp;#x26;sw_lng=-74.10145395441896&amp;#x26;ne_lat=40.81249944772398&amp;#x26;ne_lng=-73.88069742365724&amp;#x26;search_by_map=true&amp;#x26;location=Manhattan%2C+New+York%2C+NY%2C+United+States&amp;#x26;checkin=07%2F19%2F2016&amp;#x26;checkout=07%2F21%2F2016&amp;#x26;guests=&amp;#x26;ss_id=4nufl4i6&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;If I enter that in the browser, I get a bunch of JSON with loads of data about the listings. You may also notice that the search results page number &lt;code&gt;page&lt;/code&gt; and the range of coordinates (&lt;code&gt;sw_lat&lt;/code&gt;, &lt;code&gt;sw_lng&lt;/code&gt; etc) are clearly specified as URL arguments. We have discovered the JSON API for this site&apos;s data!&lt;/p&gt;
&lt;p&gt;An example for how to get and use this JSON data in Python (requires the requests module: &lt;code&gt;pip install requests&lt;/code&gt;):&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import requests
import json

#this is pretty print, it just makes JSON more human-readable in the console:
from pprint import pprint

options = dict(
    page_no = 1,
    checkin = &amp;quot;07/15/2016&amp;quot;,
    checkout = &amp;quot;07/16/2016&amp;quot;,
    sw_lat = &amp;quot;40.83397847641101&amp;quot;,
    sw_lng = &amp;quot;-74.0845568169126&amp;quot;,
    ne_lat = &amp;quot;40.88991628064286&amp;quot;,
    ne_lng = &amp;quot;-73.86380028615088&amp;quot;
)

json_url = &amp;quot;https://www.airbnb.com/search/search_results?page={page_no}&amp;amp;source=map&amp;amp;airbnb_plus_only=false&amp;amp;sw_lat={sw_lat}&amp;amp;sw_lng={sw_lng}&amp;amp;ne_lat={ne_lat}&amp;amp;ne_lng={ne_lng}&amp;amp;search_by_map=true&amp;amp;location=Manhattan,+New+York,+NY,+United+States&amp;amp;checkin={checkin}&amp;amp;checkout={checkout}&amp;amp;guests=1&amp;quot;.format(**options)

# download the raw JSON
raw = requests.get(json_url).text

# parse it into a dict
data = json.loads(raw)

# pretty-print some cool data about the 0th listing
pprint( data[&amp;#39;results_json&amp;#39;][&amp;#39;search_results&amp;#39;][0][&amp;#39;listing&amp;#39;] )
# and price info
pprint( data[&amp;#39;results_json&amp;#39;][&amp;#39;search_results&amp;#39;][0][&amp;#39;pricing_quote&amp;#39;] )&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;I can now get number of beds, bathrooms, approximate latitude and longitude, host ID, room ID, cost of renting the room, etc. And I can programmatically change the URL arguments to make different queries. This was way easier that writing a web crawler and scraper! Let me know what other interesting hidden APIs you find, or if you have any additional tips.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[VBoW Pt 2 - Image Classification in Python with Visual Bag of Words (VBoW)]]></title><link>https://ianlondon.github.io/posts/how-to-sift-opencv-vbow-part-2</link><guid isPermaLink="false">how-to-sift-opencv-vbow-part-2</guid><pubDate>Wed, 11 May 2016 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;Image Classification in Python with Visual Bag of Words (VBoW)&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;../how-to-sift-opencv-vbow-part-1&quot;&gt;Part 1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;../how-to-sift-opencv-vbow-part-2&quot;&gt;Part 2&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Part 2: The Visual Bag of Words Model&lt;/h2&gt;
&lt;h3&gt;What is a Bag of Words?&lt;/h3&gt;
&lt;p&gt;In the world of natural language processing (NLP), we often want to compare multiple documents. Documents each have a bunch of different words in a certain order. We will ignore the order and just throw the words into a bag. Then we can simply count the occurences of each word in the corpus of all words. Finally, each document is converted to a histogram of word counts, and that can be used as features for machine learning.&lt;/p&gt;
&lt;p&gt;We make our corpus of all words from taking the set of all the words in the all documents within our training set. The test set documents can have words that don&apos;t show up in the corpus -- those words will just be ignored. We have to do this because in order to feed data into a machine learning classifier, each observation must have the same number of features: we can&apos;t have one document with 100 features and another with 104 features.&lt;/p&gt;
&lt;h3&gt;Non-standard words?&lt;/h3&gt;
&lt;p&gt;On many documents we can do an exact match for words, because modern English spelling is pretty standardized. We always spell &lt;code&gt;herself&lt;/code&gt; as &lt;code&gt;herself&lt;/code&gt;. But if we take some Middle English from Chaucer&apos;s Canturbury Tales, we will find that &lt;code&gt;herself&lt;/code&gt; is spelled &lt;a href=&apos;http://sites.fas.harvard.edu/~chaucer/spelling.htm&apos;&gt;many ways:&lt;/a&gt; hire-self, herself, herselven, hireself, hireselve, hireselven, hirself, hirselve, hirselven, hirsilf, hyreself, and hyrself.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Excerpt:&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The coper teyne, noght knowing this preest,&lt;br&gt;
And hidde it, and him hente by the breest,&lt;br&gt;
And to him spak, and thus seyde in his game,&lt;br&gt;
&apos;Stoupeth adoun, by god, ye be to blame,&lt;br&gt;
Helpeth me now, as I dide yow whyl-er,&lt;br&gt;
Putte in your hand, and loketh what is ther.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/887d75b199edba889bbba72b2e2ff805/c08c5/canterbury.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAMB/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAEDBP/aAAwDAQACEAMQAAAByhntYI//xAAZEAEAAgMAAAAAAAAAAAAAAAABAAIDERL/2gAIAQEAAQUCVtmpsnc//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhAAAQUBAAAAAAAAAAAAAAAAAAECITFBUf/aAAgBAQAGPwJ3Fokw/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAERIWGRof/aAAgBAQABPyFpQ4pdlF2fB4aH/9oADAMBAAIAAwAAABB3/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAAAAf/aAAgBAwEBPxCo/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERQf/aAAgBAgEBPxDIRH//xAAcEAEAAgIDAQAAAAAAAAAAAAABESEAkTFBYYH/2gAIAQEAAT8Qr50BIQ6217l9MvCzpiTb/Of/2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Illuminated manuscript&quot;
        title=&quot;&quot;
        src=&quot;/static/887d75b199edba889bbba72b2e2ff805/1c72d/canterbury.jpg&quot;
        srcset=&quot;/static/887d75b199edba889bbba72b2e2ff805/a80bd/canterbury.jpg 148w,
/static/887d75b199edba889bbba72b2e2ff805/1c91a/canterbury.jpg 295w,
/static/887d75b199edba889bbba72b2e2ff805/1c72d/canterbury.jpg 590w,
/static/887d75b199edba889bbba72b2e2ff805/c08c5/canterbury.jpg 640w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If we have a bunch of documents in Middle English and make a histogram of the whole corpus, we&apos;ll count &lt;code&gt;hirselve&lt;/code&gt;, &lt;code&gt;hirsilf&lt;/code&gt;, and &lt;code&gt;hyreself&lt;/code&gt; as totally different words. It will be hard to figure out which documents are talking about women. Because spelling variation is such a big issue, we need some way to &lt;strong&gt;cluster&lt;/strong&gt; all the variants of a word together so that they wind up in the same bin.&lt;/p&gt;
&lt;h3&gt;&quot;Visual words&quot;&lt;/h3&gt;
&lt;p&gt;In the &lt;a href=&quot;../how-to-sift-opencv-vbow-part-1&quot;&gt;previous post&lt;/a&gt; I explained what SIFT descriptors are and how to generate them. If we think of every picture as a document of SIFT &quot;words&quot;, we can extend the bag of words model to classify images instead of text documents. We might imagine that one SIFT descriptor &quot;visual word&quot; represents an octopus eye, another one represents a tentacle &quot;suction cup&quot;, and so on.&lt;/p&gt;
&lt;p&gt;These visual words have spelling variations, just like Middle English, so we have to have some clustering method to bin together the words that represent the same thing. All the eye features should go to the same bin, all the tentacle suckers in their own bin. It&apos;s more intuitive to think of the bins as being &lt;strong&gt;codewords&lt;/strong&gt; like &quot;eye features&quot; and &quot;tentacle features&quot;.&lt;/p&gt;
&lt;p&gt;However, SIFT features are not so literal as &quot;octopus eye&quot;, they tend to represent something more like &quot;bright blob which gradually blends into darkish blob with a diagonal oblong midtone blob&quot;. We can&apos;t bin them together based on some human-meaningful definition. But we can bin them together mathematically. SIFT descriptors are 128-dimensional vectors, so we can simply make a matrix with every SIFT descriptor in our training set as its own row, and 128 columns for each of the dimensions of the SIFT features. Plug that matrix to a clustering algorithm like KMeans, then get the descriptors clustered into K different codewords (ie, K different clusters, or K different bins).&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5e49e1758d181dc061fcb75b3a25c4f7/a2510/octo_vbow_bag.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 64.86486486486486%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIFBP/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAFLeCjDih//xAAbEAEAAgIDAAAAAAAAAAAAAAABAAIRIRITFP/aAAgBAQABBQK1nvXRYmH0Nd8Cf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/AWf/xAAcEAABAwUAAAAAAAAAAAAAAAARABBRARIiMTL/2gAIAQEABj8CvFOpUsDidBEt/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAERIUExof/aAAgBAQABPyGW5pRvwZZLHBjVVD4/xCgjUJeH/9oADAMBAAIAAwAAABD0P//EABURAQEAAAAAAAAAAAAAAAAAAAAh/9oACAEDAQE/EEf/xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAECAQE/EKawVP/EAB0QAQEAAgIDAQAAAAAAAAAAAAERACExUUGR4fD/2gAIAQEAAT8QeIg9jY0Xp9xItaIu5fWAJuVF84ggKXZY4uMCVcd/pgXEu9Ez/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;bag of visual words diagram&quot;
        title=&quot;&quot;
        src=&quot;/static/5e49e1758d181dc061fcb75b3a25c4f7/1c72d/octo_vbow_bag.jpg&quot;
        srcset=&quot;/static/5e49e1758d181dc061fcb75b3a25c4f7/a80bd/octo_vbow_bag.jpg 148w,
/static/5e49e1758d181dc061fcb75b3a25c4f7/1c91a/octo_vbow_bag.jpg 295w,
/static/5e49e1758d181dc061fcb75b3a25c4f7/1c72d/octo_vbow_bag.jpg 590w,
/static/5e49e1758d181dc061fcb75b3a25c4f7/a8a14/octo_vbow_bag.jpg 885w,
/static/5e49e1758d181dc061fcb75b3a25c4f7/a2510/octo_vbow_bag.jpg 1000w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Next we go through each individual image, and assign all of its SIFT descriptors to the bin they belong in. All the &quot;eye&quot; SIFT descriptors will be converted from a 128-dimensional SIFT vector to a bin label like &quot;eye&quot; or &quot;Bin number 4&quot;. Finally we make a histogram for each image by summing the number of features for each codeword. For example, with K=3, we might get a total of 1 eye feature, 3 tentacle features, and 5 tentacle sucker features for image number 1; a different distribution for image number 2, and so on. (Remember, this is just a metaphor: real SIFT feature clusters won&apos;t have such a human-meaningful definition.)&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/12bf94a76bc07152a07fd33f88f8173c/b54c8/octo_histogram.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABXpaqCFRP/8QAGhAAAgIDAAAAAAAAAAAAAAAAAQIAAwQxQf/aAAgBAQABBQJrrAaXc46To1P/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPwFn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAHBAAAQQDAQAAAAAAAAAAAAAAAQACITEgIiNx/9oACAEBAAY/AndTdIE7OmU73D//xAAaEAACAgMAAAAAAAAAAAAAAAABEQAhEEGR/9oACAEBAAE/Ib3CCSCocKguozYvWHI//9oADAMBAAIAAwAAABD0H//EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQMBAT8Q0oJQ/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHRAAAgIBBQAAAAAAAAAAAAAAAREAITEQQWGBsf/aAAgBAQABPxAmkREiMra4I2RwQikGOPJemBrFoIVM3cxaf//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;bag of visual words histogram&quot;
        title=&quot;&quot;
        src=&quot;/static/12bf94a76bc07152a07fd33f88f8173c/1c72d/octo_histogram.jpg&quot;
        srcset=&quot;/static/12bf94a76bc07152a07fd33f88f8173c/a80bd/octo_histogram.jpg 148w,
/static/12bf94a76bc07152a07fd33f88f8173c/1c91a/octo_histogram.jpg 295w,
/static/12bf94a76bc07152a07fd33f88f8173c/1c72d/octo_histogram.jpg 590w,
/static/12bf94a76bc07152a07fd33f88f8173c/b54c8/octo_histogram.jpg 879w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;div style=&apos;text-align: center;&apos;&gt;Image 1 --&gt; &lt;code&gt;[1, 3, 5]&lt;/code&gt;&lt;/div&gt;
&lt;p&gt;At this point we have converted images with varying numbers of SIFT features into K features. We can feed the matrix of M observations and K features into a classifier like AdaBoost or SVC as our &lt;code&gt;X&lt;/code&gt;, image labels as our &lt;code&gt;y&lt;/code&gt;, and it ought to be able to predict image labels from images with some degree of accuracy.&lt;/p&gt;
&lt;h3&gt;But what is K? How many bins do we need?&lt;/h3&gt;
&lt;p&gt;For my panda detector project I performed a &lt;strong&gt;grid search&lt;/strong&gt; across a range of K values and compared the scores of classifiers for each K. My grid search code is &lt;a href=&quot;https://github.com/IanLondon/general_img_classifier/blob/master/K_grid_search.py&quot;&gt;on GitHub&lt;/a&gt; and references other files in &lt;a href=&quot;https://github.com/IanLondon/general_img_classifier&quot;&gt;the repo&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Determining what K to use for K-means &lt;a href=&quot;https://en.wikipedia.org/wiki/Determining_the_number_of_clusters_in_a_data_set&quot;&gt;is an art, not a science&lt;/a&gt;, so depending on your project (and how long it takes to do a grid search) you might want to try different methods.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[VBoW Pt 1 - Image Classification in Python with SIFT Features]]></title><link>https://ianlondon.github.io/posts/how-to-sift-opencv-vbow-part-1</link><guid isPermaLink="false">how-to-sift-opencv-vbow-part-1</guid><pubDate>Fri, 06 May 2016 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;Image Classification in Python with Visual Bag of Words (VBoW)&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;../how-to-sift-opencv-vbow-part-1&quot;&gt;Part 1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;../how-to-sift-opencv-vbow-part-2&quot;&gt;Part 2&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;Part 1: Feature Generation with SIFT&lt;/h2&gt;
&lt;h3&gt;Why we need to generate features&lt;/h3&gt;
&lt;p&gt;Raw pixel data is hard to use for machine learning, and for comparing images in general.&lt;/p&gt;
&lt;p&gt;A digital image in its simplest form is just a matrix of pixel intensity values. Why not flatten this matrix to an array of pixel intensities and use that as your feature set for an image classifier? For simple, curated images like the 20x20 pixel &lt;a href=&quot;http://yann.lecun.com/exdb/mnist/&quot;&gt;MNIST digit dataset&lt;/a&gt;, the raw pixel method can lead to a successful machine learning model. Each image has already been centered in the frame, and all the images have the same aspect ratio and same number of pixels.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 586px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e7ef4968457f6749190fa6b47cf43d6d/a76f4/mnist-2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACSElEQVR42q2Uz0uyQRDHRfDQISgCoZAOoiRKSgehS4T+A14EPQgevHjQbkFgehQvoteE/oCSUBARD17snKCICCqVZKkpCP64aH5jFvZ5H/FHEe/AsPvsPvPZmd2ZkTQaDfR6PXQ6HXS73T8p2RLj5eUFkvf3d5DM53P8VbgtgQXg19cX21iltDedTjGbzQSA+H+ak5C3ko+Pj7UeciOxJ61WC4PBYMGGjz8CudDdRKNR2O12HB0dwev1YjgcCnY/Avm8VqshGAxCp9NBIpHg5OQEZ2dn2N7eRi6XW4piJZCPb29vOD09ZSBSo9GIZrOJVCrFvuPx+O+A/IIzmQz29/eh1+vhdrtRqVTYejgcZsCHh4ffAbmMRiM8Pj7i9fVVOIRGj8fDgPf3978H0k8cQuvZbBY3NzdMDQYDVCoVisUi26dU2pg24vxKJpOwWq3Y2trCzs4OZDIZ8+76+lqw2QjkUMqzq6sr7O7uwuVyIZ1OIxAIMKBUKoVCocDd3d3mtOGnUPk4HA7mid/vZ2ulUglarRZKpRKhUAhmsxkHBwe4uLhALBZDPp//V3ocSDKZTOB0OiGXy3F7e4tCoQCfz4fDw0PYbDY8PT0JESQSCZyfn+P4+Fh48Xa7vQikyyfP9vb2YDKZoFarWXiXl5dCZfBISPr9PqgXrLxDkmq1CovFAo1Gw8KKRCIol8tLTUB8b+JDVr4y5R9VxHg8XijFdc1jKQ/F7Uu8SXNKCdJ1bW1l+/rvDbZer+Pz85O9EC38RcmWGM/Pz/gGvG14aHD2QpcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;handwritten number 2&quot;
        title=&quot;&quot;
        src=&quot;/static/e7ef4968457f6749190fa6b47cf43d6d/a76f4/mnist-2.png&quot;
        srcset=&quot;/static/e7ef4968457f6749190fa6b47cf43d6d/12f09/mnist-2.png 148w,
/static/e7ef4968457f6749190fa6b47cf43d6d/e4a3f/mnist-2.png 295w,
/static/e7ef4968457f6749190fa6b47cf43d6d/a76f4/mnist-2.png 586w&quot;
        sizes=&quot;(max-width: 586px) 100vw, 586px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;But what about images that are less simple and less curated?&lt;/p&gt;
&lt;p&gt;Imagine taking several pictures of an object with a handheld camera. Since it&apos;s the same camera, the photos will have the same resolution and aspect ratio, so the pixel matrices will be the same size &amp;#x26; shape.&lt;/p&gt;
&lt;p&gt;Consider this stereo image (via &lt;a href=&quot;http://www.waystation.net/&quot;&gt;http://www.waystation.net/&lt;/a&gt;) of an octopus:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAGF6LWE0Sv/xAAbEAACAgMBAAAAAAAAAAAAAAABAgADBBITEf/aAAgBAQABBQJql3NXNRio05p7opgRRP/EABURAQEAAAAAAAAAAAAAAAAAABAh/9oACAEDAQE/AYf/xAAVEQEBAAAAAAAAAAAAAAAAAAAQIf/aAAgBAgEBPwGn/8QAHRAAAQIHAAAAAAAAAAAAAAAAAAERAxATMTOBkf/aAAgBAQAGPwJEWJtjJwesWn//xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhMUGBsf/aAAgBAQABPyFCZEyNIauTwDcC9CWWekXlmsQton//2gAMAwEAAgADAAAAEOwP/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAEDAQE/EITH/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/EDK//8QAHRABAAIBBQEAAAAAAAAAAAAAAQARITFBUWGRcf/aAAgBAQABPxBD9HAdNYKjdwFcbwrgXUEz7BArZ0L5maQJ9BtAAaW6Qa9n/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;octopus stereo&quot;
        title=&quot;&quot;
        src=&quot;/static/a0a4eb6498665bc901fc54eb73a91b44/1c72d/StereoOctopus.jpg&quot;
        srcset=&quot;/static/a0a4eb6498665bc901fc54eb73a91b44/a80bd/StereoOctopus.jpg 148w,
/static/a0a4eb6498665bc901fc54eb73a91b44/1c91a/StereoOctopus.jpg 295w,
/static/a0a4eb6498665bc901fc54eb73a91b44/1c72d/StereoOctopus.jpg 590w,
/static/a0a4eb6498665bc901fc54eb73a91b44/8608d/StereoOctopus.jpg 638w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt; (PS: if you cross your eyes it will look 3D)&lt;/p&gt;
&lt;p&gt;Even though the two photos were taken simultaneously from locations a few inches apart, and they are very visually similar, the raw pixel locations do not match up at all. Every pixel location has been shifted and transformed in a complex way.&lt;/p&gt;
&lt;h4&gt;The problem of scale&lt;/h4&gt;
&lt;p&gt;Photographs of the same objects will also change scale depending on focal length, distance from object, et cetera. This is another reason that raw pixel values are typically not good features for images. You can see how zooming in on the octopus will totally throw off the pixel locations:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/66b00b07dbe6e8ea59bf2ed2a3091975/8608d/ZoomOctopus.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAgP/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAABTl+sqm4P/8QAGhAAAwEAAwAAAAAAAAAAAAAAAQIDABESE//aAAgBAQABBQIzHZozRFjAr5pmjyTHf//EABURAQEAAAAAAAAAAAAAAAAAAAAh/9oACAEDAQE/AYj/xAAVEQEBAAAAAAAAAAAAAAAAAAAAIf/aAAgBAgEBPwGq/8QAHBAAAgICAwAAAAAAAAAAAAAAAAECIRAREzEy/9oACAEBAAY/AlHko9tiblLZ1imf/8QAGxABAAMBAAMAAAAAAAAAAAAAAQARMUEhYYH/2gAIAQEAAT8hOt21DI6RJ8hMiPJcuV6hHWZK3h7n/9oADAMBAAIAAwAAABBs3//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EIQ//8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERUf/aAAgBAgEBPxCS8P/EABoQAQADAQEBAAAAAAAAAAAAAAEAETEhUYH/2gAIAQEAAT8QRFFwa/YxxgAoN9zclsogHj5kGjocrlPsRHVBN4BtVFrZpup//9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;octopus stereo&quot;
        title=&quot;&quot;
        src=&quot;/static/66b00b07dbe6e8ea59bf2ed2a3091975/1c72d/ZoomOctopus.jpg&quot;
        srcset=&quot;/static/66b00b07dbe6e8ea59bf2ed2a3091975/a80bd/ZoomOctopus.jpg 148w,
/static/66b00b07dbe6e8ea59bf2ed2a3091975/1c91a/ZoomOctopus.jpg 295w,
/static/66b00b07dbe6e8ea59bf2ed2a3091975/1c72d/ZoomOctopus.jpg 590w,
/static/66b00b07dbe6e8ea59bf2ed2a3091975/8608d/ZoomOctopus.jpg 638w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;Generating features with SIFT: Scale-Invariant Feature Transform&lt;/h3&gt;
&lt;p&gt;We want features that correspond to &quot;parts&quot; of images, at a more holistic level than raw pixels. We want features that are not sensitive to changes in image resolution, scale, rotation, changes in illumination (eg, position of lights). The SIFT algorithm will do this. It&apos;s going to be a little complicated, so I&apos;ll start by showing you how to do it in Python with OpenCV first, then we can go into how it works. In my &lt;a href=&quot;../visual-bag-of-words&quot;&gt;next post&lt;/a&gt; I&apos;ll show you how to convert SIFT features to a format that can be passed directly into a Random Forest, SVM, or other machine learning classifier.&lt;/p&gt;
&lt;h4&gt;Aside: installing OpenCV 3.1.0&lt;/h4&gt;
&lt;p&gt;SIFT is a patented algorithm and isn&apos;t included in many distributions of OpenCV. Also, OpenCV&apos;s function names change drastically between versions, and old code breaks! It will save you a lot of pain if you&apos;re on the same version as me (v3.1.0) for this tutorial. And you&apos;ll need the &quot;nonfree&quot; modules to have SIFT.&lt;/p&gt;
&lt;p&gt;After struggling for some time trying to get OpenCV to compile from source, I came across &lt;a href=&quot;https://rivercitylabs.org/up-and-running-with-opencv3-and-python-3-anaconda-edition/&quot;&gt;River City Labs&apos;s guide to installing OpenCV in Anaconda Python&lt;/a&gt;. Here is the gist of it.&lt;/p&gt;
&lt;p&gt;To set up a conda virtual environment called &lt;code&gt;opencv&lt;/code&gt;, install Anaconda then run this in the console:&lt;/p&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;conda create -n opencv numpy scipy scikit-learn matplotlib python=2.7
source activate opencv
conda install -c https://conda.binstar.org/menpo opencv3&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Enter your virtual environment with &lt;code&gt;source activate opencv&lt;/code&gt; and leave it with &lt;code&gt;source deactivate&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Another problem I ran into is that I run ipython in interactive mode all the time, and when you call &lt;code&gt;ipython&lt;/code&gt;, it will ignore your conda env. So I added this to my &lt;code&gt;.bashrc&lt;/code&gt;:&lt;/p&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;# virtualenv-aware ipython
alias ipy=&amp;quot;python -c &amp;#39;import IPython; IPython.terminal.ipapp.launch_new_instance()&amp;#39;&amp;quot;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Make sure to restart &lt;code&gt;bash&lt;/code&gt; so it will load the new &lt;code&gt;.bashrc&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now you can invoke a virtualenv-aware ipython shell with the new command &lt;code&gt;ipy&lt;/code&gt;. You can also launch &lt;code&gt;jupyter notebook&lt;/code&gt; while within the &lt;code&gt;opencv&lt;/code&gt; env without a problem, with or without this change to &lt;code&gt;.bashrc&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Phew, I hope that wasn&apos;t too bad. On to the code!&lt;/p&gt;
&lt;h1&gt;Generating SIFT Features in Python OpenCV&lt;/h1&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;%matplotlib inline
import cv2
import numpy as np
import matplotlib.pyplot as plt

print &amp;#39;OpenCV Version (should be 3.1.0, with nonfree packages installed, for this tutorial):&amp;#39;
print cv2.__version__

# I cropped out each stereo image into its own file.
# You&amp;#39;ll have to download the images to run this for yourself
octo_front = cv2.imread(&amp;#39;../images/Octopus_Far_Front.jpg&amp;#39;)
octo_offset = cv2.imread(&amp;#39;../images/Octopus_Far_Offset.jpg&amp;#39;)

def show_rgb_img(img):
    &amp;quot;&amp;quot;&amp;quot;Convenience function to display a typical color image&amp;quot;&amp;quot;&amp;quot;
    return plt.imshow(cv2.cvtColor(img, cv2.CV_32S))&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;OpenCV Version (should be 3.1.0, with nonfree packages installed, for this tutorial):
3.1.0&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;show_rgb_img(octo_front);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 278px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7583c6bd02ee9a4de30610728295f5da/4e29d/oct_output_2_0.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 91.8918918918919%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAAFAklEQVR42l2Ue0xTZxjGz4hsRrCIoAsT0SmIFrQKiCgUGFLADqWgHfUGw3LrFLmJZAjFIjicqAMmyqUUi20RKFCtcrEjtNyKSlDaRbxlLnM3syxb/GPZztpnXxU12Zs85zznJN8v35fvfV6KelVOCxYs3uHi4raHwXBNdHBwFtjPZQjs7OYKKMpOYGfPIN+u5O0soOzsyD/q/0okSqLs7X1ssHdsj2XuXmZvLxaILD6r/cDyDYTf+mD4bwhBhP8mpG7jYEeQPzhh0eDz9iMxfh9279qHJMEBiIRZdHgIBxQ1R0yVlpba2YBV5efvKpvUaGvu/luj7Kf71QZ6QjdNK2ob6BxeNJ0XF07nxKynm8ok9LMHf9DfTf9Cf29+Tv9g/o1+/ujFX4+nfkZhdmkxxWQy3yW8D9plmm/Hb07C0DthGe67jeG+CdwaMqFIJMQGb3fsDt2IxC3rkBC+CUNaPUzjT2CeeArT2CNMjz6mf330AoNXR8QUgJdHvtzYbh66Po5O2RWLtk1LwEbIq89Aki0Cy9MdIV7uYC1dBG4YGyO9wxjt02O8fwQm40OiJ/Sz+79D264TU25ubvMIb56qudvULe/EuZJiS/OZKuivG9B0uhJ5e3lgs9bCw8UJK993QkocF/0qBbQKJRrLj6G5ohh3R+/TP878iasqAnRwcFhMgG5dir57DacqkcuPtjR+eRqDGh1qS4oQtGoFPFydsdlzCdhkl1zmEuTGsXG+JB/lSdtQtHMzrl++QpuNM1BI298eWVojNdeWlyEt2t9SnLQTBYLtSA72RYLfKoR4uoG9yh08Py8kb/GFMJQJUfhqFHLXoyg+BNXH8unmUxX4PCNFTDk5OTkTnktmYsJ0ZcFhZPCiLZ+ymciI8EFKsDcRE7sC1yDSxwNpMcE4GBmI9FBffBa5FnmxgSgWcFCRxqclybEQJcaKqYUUxSBABp8TNp3B24qMWI4lPYos5KxDNjcAWTEBEEUHQBCwEgfIznLjgpG66UNkhXkhj7sRudsCkBy4nK44nInGWpn4TWOX5heZ84UpSGD7Wz7298ZWpgdifJZCFMFCdsw6AlmGPb5uyIzww5H4UBRsD0Ra6BoIo0JRXXyCnjKY0dXaJ6bmz5/vQnjL5RcV5hvtvThXVmk5npOHk0eP4UhqBtIj/ZDJ9gI/iIWkqI+wl70R+9kBSOd+hMO8SEiEfAy03yCX8hSy8yox5enp+R4Bzqk/22iSX7iE8oJCy8mjR/BFQT4UNfU4nsJH3k4OuuUacvPD6OvQkV7txNkSCQ7ytyM1JgjH0z6hp4bvQ9HY8zZ6TdUyc1erBqdKyi3V5adxTnICWbuikBUfia9PVJB0GNHfOQhdjx6jA5Nol6ogyTkE8UEhKguz6XsjM1BJCdDR0dGV8Dykta2m/q4hdLdq/+1VD1q1ql5r8aFD1sLMdGu3vMeq6zFYb3brrTqN3koSZb2mvGa9UFll7WpRW7/RDP9jGnuC1np1yZsdqqRq89ANIwZ6DBadxkCSMo6RvlsY7b+DMaKXfuAObHk36qYwRnyHVElieBuT+gf0w8mfXl3K66qUnLncUqccu/iVdKShpmW0taFtSFp7aUJWpxxVNXUQL79FppFBKVUbmmsUtztaNEPyC21jsjqVkYBuKurVM1VldamvebaJw5j1tkZfOOuXETnOttYKIntb7me9rRbZJtWsX25b9x89WNZfqPB+oQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;png&quot;
        title=&quot;&quot;
        src=&quot;/static/7583c6bd02ee9a4de30610728295f5da/4e29d/oct_output_2_0.png&quot;
        srcset=&quot;/static/7583c6bd02ee9a4de30610728295f5da/12f09/oct_output_2_0.png 148w,
/static/7583c6bd02ee9a4de30610728295f5da/4e29d/oct_output_2_0.png 278w&quot;
        sizes=&quot;(max-width: 278px) 100vw, 278px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;show_rgb_img(octo_offset);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 301px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/465a1e0f4a3f9c0c9971aad8d790e9d3/fb933/oct_output_3_0.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 85.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAAEvElEQVR42m2Ua0zTVxjGcRal2dgYERkqbIC1w1K5tBSsEyiggrYiOh0XUS5KKQKVmwgMEm7quEyoCFSLUC22FCyuBVqhIAiCiBLnxJllOrOLs5jt87L+939WWj6YbCd5kid5T37nfc+Tc+zsbGsNlUJlUyjUYIv/j6hUx2BHR+f/rdnqVA6F4sC1s1tFs9Kozs4bPDxob+g0P/j6BJIsv63gcsIRGbYbvOBtOLojAkd4QeCHfoZsYT6KckpQXlSJuspGxO05iFUOVGKVw2rY29v3WoHp8emuHRe6TTqVEbc0d/6ZHJojH048JSf1M2RxchyZu3cnKdrJIQv2hZIz+rvkr0//IF98+4r8ZWGRfD7/G1maV2N2clqDlRSKeom3IpAZzBrsMZrujT7CpH6OnDLMYdr4EDfkvRBwfRHA8EYsh4HdW7yQnZqK7x+8xJPZF3g8/QMWZn/EzwtviJa6K6B5M2wdZiRluPV36xcHlAPQKXXk+NA0WqrLce18I7ITD8D3k48Q5LUOdNcPkJN+DPeNUxju1eLB+Dye3HuOR1PPiFfP/kSvfMAGzBOWrldIFYstVVW43NhIDt+4hUvnzqAwOQ6VhafB+NgNn6x1hvdaJ5w4xIdB3YP26i/RkJ2IOwO3l7olfvrOhLGBaSvww7CwGHZbg+T1qSQB6k8VkKP9Y+ht60Asiw5/Tw94WWAcTzeE0TdgP4uGquPxqEnZi9N8f7RXFEKn6CPu6u9C3zdm67C2tsm1tf7CYl4SHyfjosiKtFSIYnhI3kpHLNMDEXR3hHi5YR97ExIsSuFuQmb4pyiMCcBZYTzO5gmJixWnoFForMCVGze6e4uPJpqqxEIkRQSRKdsYyIpiIjWEhvTQLUjhhYAfQMPhcDZEUYE4yvZEZsRm5AuCUXWED3GMP1ErSsblplYr8L31Li5+ybHRr3MTYpEWHUqmRnJxPNwXokgm8gTbkBMdhOORAZYD6Cg+tBPi3RxkhdKQzduMJI430iKCCZ2iH1r1sG3kktwS16riisXCY8dwKIJLCtg+2OW3ETwfD8T6eSJnlz+yeD74grkOB3zdkR4eiOxoLsR7tuIEfztUUjmxcP+lJWWtFejAYoUwlR19Jq1yCJ0XOsjqotMoz81BjSVh8eEj1m6zogKQm5CIsoxM5CXEQ3zwc2TtF0AkCEfBgR2EQdkPTbfBClzNZrN9uy5eN/UrdOiQyMhzZeWozD+JM4X5aC4vQ3H8HpwRpWJiaBYTgzNW3dHPQlrfjKK0RAj3hRGyulrLyKO2kTMzC9Z2SZW/q+U3cbWt++9zZVXmhooac3tdM5Gxf4dZuHe7ubYgnxi+MWYeUBnMQ+phYlQ7ae7rUBN1JaVE69n6v0Y0RtxUjvQs8d4NZAay1HKdyaidxPA3E6Sh/zZGtVOYMtyHXHIZ9WUVGLS8otmReUzfeoCZkYe4Z5zH3Phj9F1RwtBrIJ4/eg2t0hbKOwwGw72hRtLV2XZdLamTaqWSq5ouqUrV/FWbQSnTaPquDaqlTZ2G7ks9anm7UtPWJDOoOjWqzlaFVvq1bFB2XtZ9pUUx3lAtKV3+Du3sl8JZ9u+/5V2W7njp0GW/Yrnm8tZep2XvbJHjv3wVmnQZlHe+AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;png&quot;
        title=&quot;&quot;
        src=&quot;/static/465a1e0f4a3f9c0c9971aad8d790e9d3/fb933/oct_output_3_0.png&quot;
        srcset=&quot;/static/465a1e0f4a3f9c0c9971aad8d790e9d3/12f09/oct_output_3_0.png 148w,
/static/465a1e0f4a3f9c0c9971aad8d790e9d3/e4a3f/oct_output_3_0.png 295w,
/static/465a1e0f4a3f9c0c9971aad8d790e9d3/fb933/oct_output_3_0.png 301w&quot;
        sizes=&quot;(max-width: 301px) 100vw, 301px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;Generating SIFT features&lt;/h3&gt;
&lt;p&gt;First, convert the images to greyscale&lt;/p&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;def to_gray(color_img):
    gray = cv2.cvtColor(color_img, cv2.COLOR_BGR2GRAY)
    return gray

octo_front_gray = to_gray(octo_front)
octo_offset_gray = to_gray(octo_offset)

plt.imshow(octo_front_gray, cmap=&amp;#39;gray&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 278px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7f6b0dae6c3529481a427b5e67936009/4e29d/oct_output_5_0.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 91.8918918918919%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAAEE0lEQVR42l1U10usVxDfSLyRq8ayN4IRzCWKLWJ5UR9UbNgrll1bULigWFEQwfL5YMeC+GAXe8GGig0VXcuuMfbdFSIIouKD/gMhOfl2MnPcvYEcmP3Od74zv5n5zW9WInlfFpaWlvFWVlYZpqamMhMTE7mxsbEcz7kZGRnxd3oazv5nMrRf0X4hsG/ox87OTuvo6AhooouLC7i7u4OXlxd4e3uDj48PJCYmgr+/PwQHB0NycjKkpKRAWloaZGZmQl5eHgsICACEESR1dXVGBNjW1nY9OTkJMzMzfy0vL7PNzU12enrKhoeHWXp6OpPJZCwpKYm1t7ezl5cX9vDwwB4fH9nT0xN7e3v78/7+HioqKmokbm5uHxDvx9nZ2VuVSgUHBwfi0dERHB4ewtnZGZSWloKTkxOEhYVBUFAQhIaGwt7eHmg0Gri9vYWbmxtQq9Xs9fWVzgUJAPCSJyYmtAqFAhBYXFlZIWDo7++nqODg4ABEg729PS+ZgtF3eiIYgbPn52dYW1sTJLa2th8R7+P09LRmbm4OmpqaxJ6eHtjf34fu7m7Izc3lPFpbW4ONjQ3nDymBpaUl6OjogM7OTri6uiIaYHV1VZBgV20Q0BYv3HR1dUFWVpZIQDs7O9DY2Aiurq4glUp52bT39PQE5JN/y8/Pp/sEzoiCqamp/0oeHBzUYmMgLi5OxK5BTk4O58vPzw+cnZ0BuQZfX18ICQmB8PBwiIyMhNTUVN7l+vp6RkkUFxcLEgsLCyvEk2IkdXV1NUlBpAZER0dzQDKSi4eHByQkJFBAiIiIgNjYWA5IlCAQoySys7MFSu57MoyopgvIkRgfH88dUSZcfwREoJQZlUuNiYqK4lokTgMDAxk1D6sUvgq7qqpKS5zgZZFKo4xI2DExMRyUQEjg9I665KKmTCkwNpJdXFwQl4LE3Nxcinifx8bGtNh2aG1tFSsrK0EQBCgoKOAAlBlmwcskOsgoe8q2sLAQ1tfXmVarBRwCQYKj9h0Cftvb26sZGRkB5FGsqakBMiyBg2ZkZMDCwgLs7u6SM2mVd5kaQvQUFRWxy8vL9y4bRg9FrCWnhoYGkbrd0tLCgeRyOdA76RLHEba3t0GpVJIzF31ZWRnU1tay6+vrd0AzM7NPiGeP2Wi2trZgcXHxn42NDR1Oi668vFxXUlKiw0A61KUOwfgTwXUobh3qVjc/P6/DzP+micFpq/2aIaJrKQt0EknUtKeZPj4+5hkZ9jTvJycn/Ayni4/f+fk5u7u7e2+KYTU3N08ih6q+vr7jgYEB5fj4uGJoaOgUiVaiI+1/x6CHZHh2hmOqGB0dVaHPb1jVDv5T/YEN/WLA+6DXIy0SurV+/xOamV5aP6MZ09zr97R+oH8q/f4z+f0LnmbYTTaceEYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;png&quot;
        title=&quot;&quot;
        src=&quot;/static/7f6b0dae6c3529481a427b5e67936009/4e29d/oct_output_5_0.png&quot;
        srcset=&quot;/static/7f6b0dae6c3529481a427b5e67936009/12f09/oct_output_5_0.png 148w,
/static/7f6b0dae6c3529481a427b5e67936009/4e29d/oct_output_5_0.png 278w&quot;
        sizes=&quot;(max-width: 278px) 100vw, 278px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;def gen_sift_features(gray_img):
    sift = cv2.xfeatures2d.SIFT_create()
    # kp is the keypoints
    #
    # desc is the SIFT descriptors, they&amp;#39;re 128-dimensional vectors
    # that we can use for our final features
    kp, desc = sift.detectAndCompute(gray_img, None)
    return kp, desc

def show_sift_features(gray_img, color_img, kp):
    return plt.imshow(cv2.drawKeypoints(gray_img, kp, color_img.copy()))

# generate SIFT keypoints and descriptors
octo_front_kp, octo_front_desc = gen_sift_features(octo_front_gray)
octo_offset_kp, octo_offset_desc = gen_sift_features(octo_offset_gray)

print &amp;#39;Here are what our SIFT features look like for the front-view octopus image:&amp;#39;
show_sift_features(octo_front_gray, octo_front, octo_front_kp);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;Here are what our SIFT features look like for the front-view octopus image:&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 278px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/db8834ed226a7f563344a2091e605a0a/4e29d/oct_output_6_1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 91.8918918918919%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAAE8klEQVR42l2U/U+TVxTHOzI2o1icbHP4g+h0MbqNCCJWMTBKBVtb3lra0hZUKi86uyhYxAhFEAb4kiWOFmor7WPrkPdC11psKQUFq67qoCZTYZnzj1i2Z+13t4qa7CTfm/Pcl0/Ofc45l8F4bbGrVq3KjYuLkzGZTMmKFSuky5Ytk0ZFRUvJmjQ6OlqawEyQRuYZUYxXc/+ThKiU7PsyAnsvMqxbty64efNmEIW2bt2KxMREJCcnYXtKKnamZUJeKgeniIMMTiYKhSIUFYkgFouhkCugrDhE78nYjShGlIbR2NgYFQG2t7c/NlMULBbL3wODA7TdPkbfnp6iTWYzLZUpaIlcTAuFhXRT6zl6YWGRfvb0Kf3s+TN64fkCvfjy+V9zTx5DXaOuZ5BoPiC8tVar9cmUzwePZyLk9XgxfssL3+0ZfKc6iYwkFrLzOMjL2Y+9e3NgGxzBLf8sHjwK4OHDAAKBAP3yz5dwupwaBoBXVzb1mIIutxvXbuhDfcODcN26icudZqhOncZXWxKxhfyGjRs3IIObB5d9Al6HA+N2N/z++wj8EqAXf1+EzWbTMOLj45cT3nILZZ239Gvx/fftoRbtRYzeHIPhUifKjiuxhbUdG9eswdq1n0FUKAV1fQiGK1fQ3HoJDWcvYdo3Q7/44wWGh4c1DJK5Twkw3nqj79e2H1qhVB4JdZw/C9uIDZrmZrC27UDChi+wKzkNSdtSkJrCQom8HLXVaijLqnH4UDkGh3rp23OTMOkN766su3g1eOH8BeQWFYTKKg+ijGQ1i2Q0PT0Nu/bsxtfJO5CWng42hwseXwg+nwuRSIgShRItZ5voel0dVKpyDSM2NvYjwosrLVXM1Z+uwUGRLJSzjwMejySAkw02l4O0rAzsTt2JKkUxBLkFyOHug0CQC4mkEAeqjuHYCTVdrazAAblcQ1irmWRg7pXw58SiYij44hA/P3JQAGGREPliUm/FZcjh5ZI1GQ7Kq5DJzgSXy0ORJB9yWT4yv8miTzWcxI+GDs3bwq7TVAePqMqRwWaHWHvYSE1Lwk5WEvaTSEUFYrDZHKSwdkDAz0OxSAxZsYxEmkOuL0BTRys9ddeP3v5+DWPlypVxhLfeaDQGh0cGcb7tQuiMWo0zLXU4WlmFPJ4AHEEBAWYjl78f2ZwsZPG4KBQrIC4pwdHySgx1m+lHjx7DoNdrGJs2bfqQAN/Xa7XzPf0WnGw+F6o93opTtWpQBi2OV51AuUQFCykVm2scY7ZRWH6iUNtRi2KpAgW5eaisUNKz9+6AoizvWk+v7Q72DdjRVN8eqm3SoKmuHvIDpZBWlkF3WQcXgdnG7HA6HfBN+nC134iahm9Re6QCbXWnaf+DmdfAmJiYjyNvQ7e+e94+OoYBq+Vf2+hw2NpHhStrjoYbq1XhoZGBsONnR9jpcIQdDmfY7XGHr1PXw81NbWGrtTvsstn/CQQewmQyNbyN8BpFBd0eDxxOZ+im04lxzwQmJ92Ycjng9fqIvOR7Ej7S71PT07jj8cHQYcTA2AT89+7S8/Pz6O3t1TDeWEtLi9VgMMx2dnbe0el0M6aeHp9O132v22icMZvNvq6urvsURU1HpO/SP7D2Wn0G/dXZLq3R39ff5ybR/dbW1nb4DS/y4jCX/Eihr17yE4hilkrrc6LoSN8v+RH7JPJSLfnrI+f+A1dY02I9caUqAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;png&quot;
        title=&quot;&quot;
        src=&quot;/static/db8834ed226a7f563344a2091e605a0a/4e29d/oct_output_6_1.png&quot;
        srcset=&quot;/static/db8834ed226a7f563344a2091e605a0a/12f09/oct_output_6_1.png 148w,
/static/db8834ed226a7f563344a2091e605a0a/4e29d/oct_output_6_1.png 278w&quot;
        sizes=&quot;(max-width: 278px) 100vw, 278px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;We can also visualize how the SIFT features match up each other across the two images.&lt;/p&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;# create a BFMatcher object which will match up the SIFT features
bf = cv2.BFMatcher(cv2.NORM_L2, crossCheck=True)

matches = bf.match(octo_front_desc, octo_offset_desc)

# Sort the matches in the order of their distance.
matches = sorted(matches, key = lambda x:x.distance)

# draw the top N matches
N_MATCHES = 100

match_img = cv2.drawMatches(
    octo_front, octo_front_kp,
    octo_offset, octo_offset_kp,
    matches[:N_MATCHES], octo_offset.copy(), flags=0)

plt.figure(figsize=(12,6))
plt.imshow(match_img);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/43c78942ddc9edd1c6fd92a8b947df1b/394f7/oct_output_8_0.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAADBElEQVR42i3S3U9TZwDH8XM/9xeMhM0tRg3JlqiZw6KMlkIpVK0gdCjYVo6nb4cWTilUOqxAIRDLiwMLFuspFVZPH5CSlhfLi0bgbjFZMu809pY/wJfzND9PzC4+99+LL3OsuHj2ePHR9Mnvf0z9/NMxckGtJVqDmlw1VpD6+kpiMumJSlVCystKiEFfSq41aImxuZaoay+TpotNxMPxhG21St9+c2SNYRieiYUj+ex8Cq+W1wv3RyM4X82ivuU29jM7eLv3L94dvMHO32vYSKzgIL2Dl0tbsLb5oapsRW/fJA5fv8fhf3k6MzyJH4qKRGb32ea71eQ2llM7nzt7RugvpbX0t3IjnXuwSJcWN+n6sxd0O7NLo1MLNPVwmY6GZunVi1Za9N1pqquz0KWnOZpZyX36kD/EXno7xjyOzuY9wX6MPIwWjKyA0+oaXNC3gAuEYOkZQTAcwSNRAucdw53gPPiuaagbbqFU24yKKw5cF0Zhdo7S9XgWr6S0yDg7Au81DV6cqbQXTp6/gZLfTVDV8ThVw+GcsQNGNgizbQCs7S6qGz34tdaFMo0NlzQWGHQdKCvnoTP4qakpgP6ucZExXHHltXV2nDjbUjinaUdZZTs0VU7o6gRUX/Kh0RREyDcJN+vHZb0dNRUcaqp4qPROlFaxOGtwo0TXTu+NJ/BiZUNkHv8Vz/d13oXX5StYrV4033DjptmDm1YfzJZuDA2GQR4lEJuYwr0/B+Hv7kUjp1RZ3PAHgui+E8IfVoFywgBWRElkpJm5t+JwH8b6Bz7ZbR55bGhITkam5dh4WPZ2uWRvt1NOPOiXl2YH5ehUSJ6bHpdv9/rk6Mx9+c3BhmJTTkmRj/HEE+xnd2PMlpTJv87tIZfMFhITcewuZvFSeo49soWn0Xn8s/oc67EknNfNaLewENrsuGVqBddigd3MwqZwtHK0x+GFu80hMuJE1CLNLfAkluRXE6nOHFlzrCXT/HJcEjYWMo59suUKB4YFZVrn/7wKl8KhEL7OzDA2hV9R/QUbYsN0OpkD5QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;png&quot;
        title=&quot;&quot;
        src=&quot;/static/43c78942ddc9edd1c6fd92a8b947df1b/fcda8/oct_output_8_0.png&quot;
        srcset=&quot;/static/43c78942ddc9edd1c6fd92a8b947df1b/12f09/oct_output_8_0.png 148w,
/static/43c78942ddc9edd1c6fd92a8b947df1b/e4a3f/oct_output_8_0.png 295w,
/static/43c78942ddc9edd1c6fd92a8b947df1b/fcda8/oct_output_8_0.png 590w,
/static/43c78942ddc9edd1c6fd92a8b947df1b/394f7/oct_output_8_0.png 707w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Most of the matched points correspond to each other between the two images, despite perspective shift and some scaling.&lt;/p&gt;
&lt;h1&gt;What is SIFT doing?&lt;/h1&gt;
&lt;p&gt;I will give a very simplified, intuitive, visual description of the SIFT algorithm here.&lt;/p&gt;
&lt;p&gt;For a nice overview of SIFT with pictures, see &lt;a href=&quot;https://gilscvblog.com/2013/08/18/a-short-introduction-to-descriptors/&quot;&gt;https://gilscvblog.com/2013/08/18/a-short-introduction-to-descriptors/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;For an in-depth explanation, see &lt;a href=&quot;http://docs.opencv.org/3.1.0/da/df5/tutorial_py_sift_intro.html&quot;&gt;http://docs.opencv.org/3.1.0/da/df5/tutorial_py_sift_intro.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;For the deepest depth, read the original academic paper &lt;a href=&quot;https://www.cs.ubc.ca/~lowe/papers/ijcv04.pdf&quot;&gt;https://www.cs.ubc.ca/~lowe/papers/ijcv04.pdf&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;1) Difference of Gaussians&lt;/h2&gt;
&lt;p&gt;If you&apos;ve messed with Photoshop or GIMP you know what a Gaussian blur is. You set the &quot;size&quot; of the blur in pixels -- this number is also called &lt;code&gt;sigma&lt;/code&gt;. Then you get a uniformly blurred image.&lt;/p&gt;
&lt;p&gt;The Difference of Gaussians (DoG) is easy to do in Photoshop/GIMP. First greyscale the image. Then duplicate the layer a few times and do a Gaussian Blur on each one with a different sigma value. Finally, set the layer blending mode to &quot;Difference&quot; for all the layers, and look at any 2 layers.&lt;/p&gt;
&lt;p&gt;&quot;Difference&quot; simply subtracts the pixel intensities of corresponding pixels: &lt;code&gt;difference[x][y] = layer1[x][y] - layer2[x][y]&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;I did this with my stereo octopus image. Here are a few DoG results:&lt;/p&gt;
&lt;style&gt;.gauss {height: 400px;}&lt;/style&gt;
&lt;h4&gt;sigmas: 10, 5&lt;/h4&gt;
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/0dc3622ecb95fb3d544238b774728a14/8608d/octopus_gauss_10_5.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAGfAB//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAE/IV//2gAMAwEAAgADAAAAEPPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAFhABAQEAAAAAAAAAAAAAAAAAABEB/9oACAEBAAE/EIiK3Vf/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;octopus gauss 10 5&quot; title=&quot;&quot; src=&quot;/static/0dc3622ecb95fb3d544238b774728a14/1c72d/octopus_gauss_10_5.jpg&quot; srcset=&quot;/static/0dc3622ecb95fb3d544238b774728a14/a80bd/octopus_gauss_10_5.jpg 148w,
/static/0dc3622ecb95fb3d544238b774728a14/1c91a/octopus_gauss_10_5.jpg 295w,
/static/0dc3622ecb95fb3d544238b774728a14/1c72d/octopus_gauss_10_5.jpg 590w,
/static/0dc3622ecb95fb3d544238b774728a14/8608d/octopus_gauss_10_5.jpg 638w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;h4&gt;sigmas: 25, 5&lt;/h4&gt;
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/c9e03b453933c288cf77c69fcbc23ab7/8608d/octopus_gauss_25_5.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABwkBR/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGhAAAgIDAAAAAAAAAAAAAAAAABEBMUFhcf/aAAgBAQABPyHslZFGxjGf/9oADAMBAAIAAwAAABAzD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAQUAAAAAAAAAAAAAAAEAESExQWFxgf/aAAgBAQABPxBpcj7KphSx1XNzoRW4QVYn/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;octopus gauss 25 5&quot; title=&quot;&quot; src=&quot;/static/c9e03b453933c288cf77c69fcbc23ab7/1c72d/octopus_gauss_25_5.jpg&quot; srcset=&quot;/static/c9e03b453933c288cf77c69fcbc23ab7/a80bd/octopus_gauss_25_5.jpg 148w,
/static/c9e03b453933c288cf77c69fcbc23ab7/1c91a/octopus_gauss_25_5.jpg 295w,
/static/c9e03b453933c288cf77c69fcbc23ab7/1c72d/octopus_gauss_25_5.jpg 590w,
/static/c9e03b453933c288cf77c69fcbc23ab7/8608d/octopus_gauss_25_5.jpg 638w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;h4&gt;sigmas: 25, 10&lt;/h4&gt;
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/37e07983e779dafb8ce32b4e1b21de74/8608d/octopus_gauss_25_10.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAGCAD//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAaEAABBQEAAAAAAAAAAAAAAAAAASAhMUFx/9oACAEBAAE/IeqVpDP/2gAMAwEAAgADAAAAEMDP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAQEBAAMAAAAAAAAAAAAAAQAhEUFRYf/aAAgBAQABPxB10YxiuLyt34S+yFv/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;octopus gauss 25 10&quot; title=&quot;&quot; src=&quot;/static/37e07983e779dafb8ce32b4e1b21de74/1c72d/octopus_gauss_25_10.jpg&quot; srcset=&quot;/static/37e07983e779dafb8ce32b4e1b21de74/a80bd/octopus_gauss_25_10.jpg 148w,
/static/37e07983e779dafb8ce32b4e1b21de74/1c91a/octopus_gauss_25_10.jpg 295w,
/static/37e07983e779dafb8ce32b4e1b21de74/1c72d/octopus_gauss_25_10.jpg 590w,
/static/37e07983e779dafb8ce32b4e1b21de74/8608d/octopus_gauss_25_10.jpg 638w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;h4&gt;sigmas: 100, 25&lt;/h4&gt;
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/292f3f2ff89b46374b2cc39e1efcd0d4/8608d/octopus_gauss_100_25.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAeIjSkj/xAAWEAEBAQAAAAAAAAAAAAAAAAAAESH/2gAIAQEAAQUCxjFVX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABgQAQEBAQEAAAAAAAAAAAAAABEAYRBB/9oACAEBAAE/IRZHiN8KV//aAAwDAQACAAMAAAAQ4w//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhUTFhcf/aAAgBAQABPxC0WpTO4hdnq+Itv5LHILtjZkHqaqPJ/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;octopus gauss 100 25&quot; title=&quot;&quot; src=&quot;/static/292f3f2ff89b46374b2cc39e1efcd0d4/1c72d/octopus_gauss_100_25.jpg&quot; srcset=&quot;/static/292f3f2ff89b46374b2cc39e1efcd0d4/a80bd/octopus_gauss_100_25.jpg 148w,
/static/292f3f2ff89b46374b2cc39e1efcd0d4/1c91a/octopus_gauss_100_25.jpg 295w,
/static/292f3f2ff89b46374b2cc39e1efcd0d4/1c72d/octopus_gauss_100_25.jpg 590w,
/static/292f3f2ff89b46374b2cc39e1efcd0d4/8608d/octopus_gauss_100_25.jpg 638w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;p&gt;By doing Difference of Gaussians at different scales, we can see features that appear small and large in the image. In contrast if we only looked at the 100, 25 DoG, we would lose a lot of detail. If we looked only at the 25, 5 DoG, we would miss out on larger-scale features.&lt;/p&gt;
&lt;p&gt;Immediately you can see how edges are suddenly very apparent. DoG functions as an edge detector. However, &lt;strong&gt;we do NOT want to use edges&lt;/strong&gt; as feature-rich areas for SIFT. We want our SIFT features to be at intrinsically interesting blobs, not edge blobs. We can start again from the original image and use an edge detector to determine edges (I used Sobel, canonical SIFT uses its own):&lt;/p&gt;
&lt;h4&gt;Edge detector output&lt;/h4&gt;
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/73a5d62023d17e7b22c0d288026ba893/8608d/octopus_edge_detect.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAckhjID/xAAYEAADAQEAAAAAAAAAAAAAAAAAARICE//aAAgBAQABBQKBYZzZbLY9n//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABYQAQEBAAAAAAAAAAAAAAAAABABMf/aAAgBAQAGPwIy0w//xAAcEAACAgIDAAAAAAAAAAAAAAABEQAhMWFBUXH/2gAIAQEAAT8hcgs2IwixCwrYEqGPe4ROgeNQhVcT/9oADAMBAAIAAwAAABADz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQADAAIDAAAAAAAAAAAAAAEAESFBUWFxsf/aAAgBAQABPxAbLyFlHt4mqN01b4qZaxq0SZgBEsfUqHIa20wwEotuveT/2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;octopus edge detect&quot; title=&quot;&quot; src=&quot;/static/73a5d62023d17e7b22c0d288026ba893/1c72d/octopus_edge_detect.jpg&quot; srcset=&quot;/static/73a5d62023d17e7b22c0d288026ba893/a80bd/octopus_edge_detect.jpg 148w,
/static/73a5d62023d17e7b22c0d288026ba893/1c91a/octopus_edge_detect.jpg 295w,
/static/73a5d62023d17e7b22c0d288026ba893/1c72d/octopus_edge_detect.jpg 590w,
/static/73a5d62023d17e7b22c0d288026ba893/8608d/octopus_edge_detect.jpg 638w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;h4&gt;Remove edges from DoG (sigma 25, 10) -- &quot;Artist&apos;s Rendering&quot;&lt;/h4&gt;
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/379c45eda320a646f79705faaff7ed8f/8608d/octopus_edge_removed_DoG10_5.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABwkoB/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRAAAwADAAAAAAAAAAAAAAAAAAERQVFh/9oACAEBAAE/IZtkmWRdKUp//9oADAMBAAIAAwAAABDjD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQACAgMBAAAAAAAAAAAAAAEAESFBMVFhgf/aAAgBAQABPxBDyP2FGILOLeiS/RcXsJfRP//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;octopus edge removed DoG10 5&quot; title=&quot;&quot; src=&quot;/static/379c45eda320a646f79705faaff7ed8f/1c72d/octopus_edge_removed_DoG10_5.jpg&quot; srcset=&quot;/static/379c45eda320a646f79705faaff7ed8f/a80bd/octopus_edge_removed_DoG10_5.jpg 148w,
/static/379c45eda320a646f79705faaff7ed8f/1c91a/octopus_edge_removed_DoG10_5.jpg 295w,
/static/379c45eda320a646f79705faaff7ed8f/1c72d/octopus_edge_removed_DoG10_5.jpg 590w,
/static/379c45eda320a646f79705faaff7ed8f/8608d/octopus_edge_removed_DoG10_5.jpg 638w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;h2&gt;Keypoint detection&lt;/h2&gt;
&lt;p&gt;Now with the edges removed, we will go over different image scales and find at which scale an interesting blob is best represented. In image classification literature, the scale of a feature is called the &quot;octave&quot;. So for each interesting blob we save its octave, x, and y coordinates as a keypoint.&lt;/p&gt;
&lt;h2&gt;Rotation normalization&lt;/h2&gt;
&lt;p&gt;We want to be able to match features regardless of their orientation, so that we can match a part of an eye or tentacle no matter how the eye or tentacle is rotated. To solve this problem, SIFT features are assigned an &quot;orientation&quot; based on the pixel intensities of the surrounding area.&lt;/p&gt;
&lt;p&gt;Essentially, you can imagine that we have some rule about orientation -- for example, we could make a rule that the direction pointing from the center of the feature to brightest region of neighboring pixels is selected as a feature&apos;s &quot;orientation&quot; direction. Then we turn the feature so that &quot;orientation&quot; (the brightest region) is pointing upwards. Now all similar features will &quot;line up&quot; with each other, even if they are rotated differently in the images they come from:&lt;/p&gt;
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/7753ebb1abec0113cf2c779b15f43e3a/41be6/orientation_normalization.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAC4jAAAuIwF4pT92AAADDUlEQVR42nWUy09TQRTGywKslbQqBhoRSCCwIayhCxO3hBUbEhIWiMF/wKAhSozoFsMjbIWmYHRjgqj4IgiGimgplFKkl0cLbWlLHwi9be9t7/2ce9pUMTDJ6U1nzvzOOfOdGRXYkCSJTJZlyMpXmQxuAy4LUk4zUtsWILCBtDKXFgExAeaM04ZK+UmlUhAEgUwURaTTaSDqhbS3ysAcpH0HHNOvEHOvsXkf5JAbEvM7E9jd3Y3q6moYDAbU19fDaDRml2Xs+fbxtH8Q+tJrMI0/p1kKeMYgYGtrK1QqFXQ6HfLz89Hb20uLprExXCkqgl6vxwWNBjU1NTg6OkQ0ImJ9PcIqk08HdnR0ELCsrAxXS0vxuPcRmw1jvP8JtJeKUFVZiYKCAvLp6rrDQEDPg5/weXmCJJMCnX8O2NLSQllUVFTQpoc99wHrC2B5Eq03b+OiTgu1Wo3CwkL09fXRRr8/BJ7nCaQcwQmg1WrF7Ows2cTEBDiOy5Vgs9lQXl6Ozs5OeDwemuP5OAKBIBKJBAlKp/0vUIkQi8UoYjweJ2P9w5wkUj4SiZD6gUAgJwjPx6hUBUrtls2UgCaTCSUlJairqyNh2traMlGlNPWnxWJBe3s7GhoMbJOIgwMBKys+RKNhJlKMZZlm4CQFJ+Dw8DCdnVJaXl4empqaCBiNRtHY2AgNU7i2tpZ8jMYRTE2FMfLMgWDAlSv5hMoDgwPkrFhxcTG67t4D1j4jtfAShus3WOtcpsyV9aqqalZ6CGkJcHA87M44djwC/AcilU3AocEhcj5/Tg2N+jwr7xaw9R3gZvDm/Semsg5arTYLrATn3KBsVtZ5zC3GMG0+htefuTmqWIqHw/ULr2cm8WH+I97OvcO8zYyk9PdqNTc30/mOjo6SCNR7goQlexzmJR5buwL7n1XZdbiLRb8F34I/MB9YgP3QgS/er7D6l3NAt9tNSmceksxGUZSxupGAhUHtziQ4V5LeC9WRcIzt6A6coU1w4U3s/fZiI8xBCfT/yLxI2VsuK+0mkynZidlr+AfSJ8zvUnwH6wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;orientation normalization&quot; title=&quot;&quot; src=&quot;/static/7753ebb1abec0113cf2c779b15f43e3a/fcda8/orientation_normalization.png&quot; srcset=&quot;/static/7753ebb1abec0113cf2c779b15f43e3a/12f09/orientation_normalization.png 148w,
/static/7753ebb1abec0113cf2c779b15f43e3a/e4a3f/orientation_normalization.png 295w,
/static/7753ebb1abec0113cf2c779b15f43e3a/fcda8/orientation_normalization.png 590w,
/static/7753ebb1abec0113cf2c779b15f43e3a/41be6/orientation_normalization.png 638w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;h2&gt;Keypoint descriptor generation&lt;/h2&gt;
&lt;p&gt;We finally have our keypoints: x, y, and octave locations for all our points of interest, plus orientation. The keypoints are scale-invariant and rotation-invariant. We could probably take raw intensity values from each keypoint region at this point and come up with a half-decent match on similar features. However, SIFT takes it a step further by instead generating descriptors for each keypoint not with raw intensity values, but by computing the &lt;strong&gt;gradient&lt;/strong&gt; of each pixel (a gradient is a vector of partial derivatives, so for a pixel its gradient describes how intensity changes as X and Y change). Then it bins the gradients into 8 directions (like N, NE, E, SE, S, SW, W, NW) and builds an 8-bin histogram.&lt;/p&gt;
&lt;p&gt;One advantage of this process, called histogram of oriented gradients, is that it is very robust against changes in illumination conditions across images.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://gilscvblog.com/2013/08/18/a-short-introduction-to-descriptors/&quot;&gt;Gil&apos;s CV Blog&lt;/a&gt; has some great explanatory illustrations of this how SIFT generates its descriptors:&lt;/p&gt;
&lt;h3&gt;Compute the gradient for each pixel at a given octave:&lt;/h3&gt;
&lt;img src=&quot;https://gilscvblog.files.wordpress.com/2013/08/figure4.jpg&quot; class=&quot;gil&quot;&gt;
*via Gil&apos;s CV Blog*
&lt;h3&gt;Divide the feature region into 16 square subregions. Bin each region into an 8-direction histogram&lt;/h3&gt;
&lt;img src=&quot;https://gilscvblog.files.wordpress.com/2013/08/figure5.jpg&quot; class=&quot;gil&quot;&gt;
*via Gil&apos;s CV Blog*
&lt;h3&gt;Concatenate the 16 histograms together to get the final 128-element SIFT descriptor!&lt;/h3&gt;
&lt;img src=&quot;https://gilscvblog.files.wordpress.com/2013/08/figure6.jpg&quot; class=&quot;gil&quot;&gt;
*via Gil&apos;s CV Blog*
&lt;h4&gt;Here&apos;s a real-life descriptor from our octopus&lt;/h4&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;octo_front_desc[0]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;array([   1.,    0.,    0.,    0.,    0.,    0.,    0.,    1.,   65.,
          6.,    1.,    0.,    0.,    0.,    2.,   24.,  195.,    1.,
          0.,    0.,    0.,    0.,    0.,  123.,   72.,    0.,    0.,
         12.,   14.,    2.,    2.,   37.,    2.,    2.,    0.,    0.,
          0.,    0.,    1.,    1.,  141.,   12.,    0.,    0.,    0.,
          0.,    2.,   27.,  195.,   34.,    2.,    4.,    3.,    1.,
          0.,   88.,   54.,   10.,    4.,   38.,   48.,    6.,    1.,
         21.,    3.,    1.,    1.,    0.,    0.,    0.,    1.,    5.,
        139.,   19.,    4.,    1.,    0.,    0.,    2.,   12.,  195.,
         73.,    3.,    3.,    1.,    1.,    0.,    2.,   52.,   17.,
          5.,   24.,   15.,    7.,    6.,    3.,    1.,    1.,    2.,
          1.,    0.,    0.,    2.,    2.,   81.,   17.,    4.,    2.,
          0.,    0.,    4.,    6.,  195.,   81.,    0.,    0.,    0.,
          0.,    0.,    1.,   59.,   18.,    0.,    3.,   10.,    3.,
          1.,    1.], dtype=float32)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Let&apos;s inspect a keypoint object that we generated earlier.&lt;/p&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;print len(octo_front_kp), &amp;#39;keypoints in the list&amp;#39;
print octo_front_kp[0]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;416 keypoints in the list
&amp;lt;KeyPoint 0x7f7dd3ad47e0&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;def explain_keypoint(kp):
    print &amp;#39;angle\n&amp;#39;, kp.angle
    print &amp;#39;\nclass_id\n&amp;#39;, kp.class_id
    print &amp;#39;\noctave (image scale where feature is strongest)\n&amp;#39;, kp.octave
    print &amp;#39;\npt (x,y)\n&amp;#39;, kp.pt
    print &amp;#39;\nresponse\n&amp;#39;, kp.response
    print &amp;#39;\nsize\n&amp;#39;, kp.size

print &amp;#39;this is an example of a single SIFT keypoint:\n* * *&amp;#39;
explain_keypoint(octo_front_kp[0])&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;this is an example of a single SIFT keypoint:
* * *
angle
79.6034545898

class_id
-1

octave (image scale where feature is strongest)
12714495

pt (x,y)
(145.86351013183594, 10.573795318603516)

response
0.0161379538476

size
2.14202713966&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;print &amp;#39;SIFT descriptors are vectors of shape&amp;#39;, octo_front_desc[0].shape
print &amp;#39;they look like this:&amp;#39;
octo_front_desc[0]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;SIFT descriptors are vectors of shape (128,)
they look like this:





array([   1.,    0.,    0.,    0.,    0.,    0.,    0.,    1.,   65.,
          6.,    1.,    0.,    0.,    0.,    2.,   24.,  195.,    1.,
          0.,    0.,    0.,    0.,    0.,  123.,   72.,    0.,    0.,
         12.,   14.,    2.,    2.,   37.,    2.,    2.,    0.,    0.,
          0.,    0.,    1.,    1.,  141.,   12.,    0.,    0.,    0.,
          0.,    2.,   27.,  195.,   34.,    2.,    4.,    3.,    1.,
          0.,   88.,   54.,   10.,    4.,   38.,   48.,    6.,    1.,
         21.,    3.,    1.,    1.,    0.,    0.,    0.,    1.,    5.,
        139.,   19.,    4.,    1.,    0.,    0.,    2.,   12.,  195.,
         73.,    3.,    3.,    1.,    1.,    0.,    2.,   52.,   17.,
          5.,   24.,   15.,    7.,    6.,    3.,    1.,    1.,    2.,
          1.,    0.,    0.,    2.,    2.,   81.,   17.,    4.,    2.,
          0.,    0.,    4.,    6.,  195.,   81.,    0.,    0.,    0.,
          0.,    0.,    1.,   59.,   18.,    0.,    3.,   10.,    3.,
          1.,    1.], dtype=float32)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;# visualized another way:
plt.imshow(octo_front_desc[0].reshape(16,8), interpolation=&amp;#39;none&amp;#39;);&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 142px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fdf0cdfc0fc57aab780b9a465e56150e/0d76a/oct_output_15_0.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 176.76056338028167%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAjCAYAAACU9ioYAAAACXBIWXMAAAsSAAALEgHS3X78AAAGQElEQVR42nVWC2xTZRQ+t/e23WBbyzYeIog8ZSOdg22yhY0lPBQGBMgg4HgNgfFQwiPAcDBGS6F0L9iAwXi0YzCQaYhEHoqQMTQYHkGDmBgS4yMxmKgJiSHGXJrj99//r4wKTb6e9vb+3z3/d75z/hLJl2a9OwsGUuL4PDImZxPl5RCNzXkas7vEvJxnf5+UYxgTR7tchW7Fl9UNb8OJiluJyplok0m0gdVn4P2YuLlL3CjuixjGOh42bM50yZc+22GlOXBzWBt5msm1F4QBJs2Pm32A9wUQv+3Afc0RZ1wLezyrFWEHG1Y892WImJmKvwDhUSa9Xi3aDlQ9B3go7QYeRuwGc1raQUmYVVZmF3FI6eZwTm0b9/A0gXAfa7aAIotFlBDZkZ8nTD0aWbjiBM8oXisJc4niEQYsJa3lCBGPolkgrGEbbVMLtwJbgAqFbaxp4nqlhdu3+kawLw40pEnC9PR0S8MxRUWhOe8t4X6DNpriyZq2XS1qAA4Dx4AWoFpl6rOwMrghUndhPZeuXaA0ZKmho/NaqBs01EvOmFYVDa/K6DxwF7gP/KCIRcGCUsMRDyPGWGg4XmlIZc2WhgnLasLJ+66x4/UDplVFm09t9xDQBsAB9CFQp6q8C9jJxquXIgmZNzizwDs9xofLjhM1iuqZMgPvCzWU15Vt4EO7sR5VVj4sy8qyMpw7NjfsnVfEaf39IGxnm1atNHxRlf0yS+f5iMPVwZ7MCknIHWRp2Nmkh/gBccmbW0D4DRt6Q5eMKlXc9nwf2hnGVho2Z5GVYf04R+juQuJxngaTUh+xHh+WBCJTrRbAYi2gtulVcQe/UtYZyQh+ywWlfkmYQdQdwfO2ZrRUI2HPoBMm5TPbenwkF2p7lHV2q21COy2qbyUX3doXeYf3c1HDUtUpWbJTMvJXhCfMCXKvtMsmJf/EWtxpua0+nzENhm3euME07ismt8gcD9F2WZr2K7keGVFxnwtKVIZ4kOxlL3r5Cjyffw8aXkQvC6vsBdHPTNNxvTzCMAHIL+M6SLUaVWnZy55oL1OW9GFcdk24+9TrbLz0gWktsO2X20w9w9T/EpMHBh+NByUelN1iZQgdbZ9GHPE3UJTKqA8zhIajYCD4UNzsM+Wsiw6ACjX/yhW2qqr7lKYNmId74cNS5cMy6cO1xSPDbZvzOHt4IwjvsE0XLVYrK6v5ZOfYRJGiftypuqUdtrmIDMtjfBiCD3+FD4uOmFaD6+dYjDE5DJ43FwOqn6+A8DYIVeulxFNfEf158UevTiYevwm9HHrM9swzMkNbnSLd+d+Eedp2AodBeByEah46ccog9F1k1w8FkVpua6OZyI85bmabzEIPqq15Vads7/JZ6OmHhj5oqMaXyzXAOq0Gv1UZylp8ilPn3jKNeb+x3v+snCxaJ+L3wFXgAnBcTaADLIdJPTKsRYbLY3y49UYIo48p7xE0/B1bvaQ65BcWmsJvwI/AZTXG2hR5IwjrQLhKEXbv1ds69QZ7j+nZ51hLOWmSdhKEIoMaNaXb2Tq4LFvVK03rZcdQLQhrumRIzol460U0r1nqU2FK7/lUJavUPIzOxKgP1fii3dBw51MNe6anJ4jY3x8IpXVc5MSCz0F4kzW9VWVQowaDT5FH7VOnNGxChs1Pz+VC7rA0HN7ZHMrnrzml5AEI/2DN+FgtqI2pcpWKDUqC8LO2cTgcQxHip+WPPLJmSh6PqW4yB1/9jhNzD0sSm7+LsWMntvBmjaqyGl9xSBKh9zK73tyAcs5uLTdz+Sanztxj6abpVV08tzVmegvsAGEXH0ZPvT6rmo4O2n+Tk+fe/7v7mIem0bNFFOcJaUHE6idErYhnEUWvi2u7xGEm4j92e4AzMlZOk4TNdyxCaoQP78FvE//CTX+yzX6Kdb0C2APUA58AncARoBYIAjvYZgtGnM4AZ2ZGfVhVZRPBXbyxIHmJb11K/rH5CamBMnfPtQuSEiavcLtLFyUlFSNuQlzxrsu1tDQpadZyl2v+YpdrxjK3e/FCt3vKmqFDp7xMMS9hn9cAXfzXEfUCBqo4SLY9pUnZre/JgCiocElf+t9r9mydJq12UmEVbijEIvGfZwCiOHMmgaxdlxDfxX/KQtw3xCm/izWk/QtT4qBYUUB5UAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;png&quot;
        title=&quot;&quot;
        src=&quot;/static/fdf0cdfc0fc57aab780b9a465e56150e/0d76a/oct_output_15_0.png&quot;
        srcset=&quot;/static/fdf0cdfc0fc57aab780b9a465e56150e/0d76a/oct_output_15_0.png 142w&quot;
        sizes=&quot;(max-width: 142px) 100vw, 142px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Giant Panda Detector - Image Classification with SIFT Features]]></title><link>https://ianlondon.github.io/posts/panda-detector</link><guid isPermaLink="false">panda-detector</guid><pubDate>Thu, 05 May 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I made a flask app that guesses whether an image is or is not an image of a giant panda. It uses &lt;a href=&quot;../how-to-sift-opencv-vbow-part-1/&quot;&gt;SIFT features&lt;/a&gt; to build a Visual Bag of Words model.&lt;/p&gt;
&lt;p&gt;View the source on &lt;a href=&quot;https://github.com/IanLondon/general_img_classifier&quot;&gt;GitHub&lt;/a&gt;&lt;/p&gt;
&lt;iframe src=&quot;http://ec2-52-202-131-49.compute-1.amazonaws.com/panda_app/&quot; style=&apos;border:none;&apos; height=&quot;400px&quot; width=&quot;600px&quot;&gt;&lt;/iframe&gt;</content:encoded></item><item><title><![CDATA[Pickling in Python - The Very Basics]]></title><link>https://ianlondon.github.io/posts/pickling-in-python-basics</link><guid isPermaLink="false">pickling-in-python-basics</guid><pubDate>Thu, 14 Apr 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;You just ran through a time-consuming process to load a bunch of data into a python object. Maybe you scraped data from thousands of websites. Maybe you computed a zillion digits of pi. If your laptop battery dies or if python crashes, your information will be lost.&lt;/p&gt;
&lt;p&gt;Pickling allows you to save a python object as a binary file on your hard drive. After you pickle your object, you can kill your python session, reboot your computer if you want, and later load your object into python again.&lt;/p&gt;
&lt;p&gt;You could back up your pickle file to Google Drive or DropBox or a plain old USB stick if you wanted. You could email it to a friend.&lt;/p&gt;
&lt;p&gt;A word of warning: don&apos;t load pickles that you don&apos;t trust. Malicious people can make malicious pickles that may execute unexpected code on your computer (SQL injection, password brute forcing, etc). Stay away from bad pickles.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import pickle

# make an example object to pickle
some_obj = {&amp;#39;x&amp;#39;:[4,2,1.5,1], &amp;#39;y&amp;#39;:[32,[101],17], &amp;#39;foo&amp;#39;:True, &amp;#39;spam&amp;#39;:False}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;To save a pickle, use &lt;code&gt;pickle.dump&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;A convention is to name pickle files &lt;code&gt;*.pickle&lt;/code&gt;, but you can name it whatever you want.&lt;/p&gt;
&lt;p&gt;Make sure to &lt;code&gt;open&lt;/code&gt; the file in &lt;code&gt;&apos;wb&apos;&lt;/code&gt; mode (write binary). This is more cross-platform friendly than &lt;code&gt;&apos;w&apos;&lt;/code&gt; mode (write text) which might not work on Windows, etc.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;with open(&amp;#39;mypickle.pickle&amp;#39;, &amp;#39;wb&amp;#39;) as f:
    pickle.dump(some_obj, f)

# note that this will overwrite any existing file
# in the current working directory called &amp;#39;mypickle.pickle&amp;#39;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;For the purposes of demonstration, I&apos;ll delete the original object from memory to show you that it&apos;s really gone.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;del some_obj

print some_obj&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;---------------------------------------------------------------------------

NameError                                 Traceback (most recent call last)

&amp;lt;ipython-input-3-3080f97d7e85&amp;gt; in &amp;lt;module&amp;gt;()
      1 del some_obj
      2
----&amp;gt; 3 print some_obj


NameError: name &amp;#39;some_obj&amp;#39; is not defined&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Loading the pickled file from your hard drive is as simple as &lt;code&gt;pickle.load&lt;/code&gt; and specifying the file path:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;with open(&amp;#39;mypickle.pickle&amp;#39;) as f:
    loaded_obj = pickle.load(f)

print &amp;#39;loaded_obj is&amp;#39;, loaded_obj&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;loaded_obj is {&amp;#39;y&amp;#39;: [32, [101], 17], &amp;#39;x&amp;#39;: [4, 2, 1.5, 1], &amp;#39;foo&amp;#39;: True, &amp;#39;spam&amp;#39;: False}&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h1&gt;Pickling pandas DataFrames&lt;/h1&gt;
&lt;p&gt;Pandas has a very easy to use pickling functions. First we&apos;ll make an example dataframe:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;import pandas as pd

df = pd.DataFrame([range(11), range(100,110)], columns=list(&amp;#39;abcdefghijk&amp;#39;))

df&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;div&gt;
&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;
  &lt;thead&gt;
    &lt;tr style=&quot;text-align: right;&quot;&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;a&lt;/th&gt;
      &lt;th&gt;b&lt;/th&gt;
      &lt;th&gt;c&lt;/th&gt;
      &lt;th&gt;d&lt;/th&gt;
      &lt;th&gt;e&lt;/th&gt;
      &lt;th&gt;f&lt;/th&gt;
      &lt;th&gt;g&lt;/th&gt;
      &lt;th&gt;h&lt;/th&gt;
      &lt;th&gt;i&lt;/th&gt;
      &lt;th&gt;j&lt;/th&gt;
      &lt;th&gt;k&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;0&lt;/th&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;6&lt;/td&gt;
      &lt;td&gt;7&lt;/td&gt;
      &lt;td&gt;8&lt;/td&gt;
      &lt;td&gt;9&lt;/td&gt;
      &lt;td&gt;10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;1&lt;/th&gt;
      &lt;td&gt;100&lt;/td&gt;
      &lt;td&gt;101&lt;/td&gt;
      &lt;td&gt;102&lt;/td&gt;
      &lt;td&gt;103&lt;/td&gt;
      &lt;td&gt;104&lt;/td&gt;
      &lt;td&gt;105&lt;/td&gt;
      &lt;td&gt;106&lt;/td&gt;
      &lt;td&gt;107&lt;/td&gt;
      &lt;td&gt;108&lt;/td&gt;
      &lt;td&gt;109&lt;/td&gt;
      &lt;td&gt;NaN&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;h3&gt;pandas.DataFrame.to_pickle&lt;/h3&gt;
&lt;p&gt;Save the dataframe to a pickle file called &lt;code&gt;my_df.pickle&lt;/code&gt; in the current working directory.&lt;/p&gt;
&lt;p&gt;Then for the purposes of demonstration again, I&apos;ll delete the original DataFrame&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;df.to_pickle(&amp;#39;my_df.pickle&amp;#39;)

del df&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h3&gt;pandas.DataFrame.read_pickle&lt;/h3&gt;
&lt;p&gt;To load the pickled dataframe, simply do:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;df2 = pd.read_pickle(&amp;#39;my_df.pickle&amp;#39;)

df2&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;div&gt;
&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;
  &lt;thead&gt;
    &lt;tr style=&quot;text-align: right;&quot;&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th&gt;a&lt;/th&gt;
      &lt;th&gt;b&lt;/th&gt;
      &lt;th&gt;c&lt;/th&gt;
      &lt;th&gt;d&lt;/th&gt;
      &lt;th&gt;e&lt;/th&gt;
      &lt;th&gt;f&lt;/th&gt;
      &lt;th&gt;g&lt;/th&gt;
      &lt;th&gt;h&lt;/th&gt;
      &lt;th&gt;i&lt;/th&gt;
      &lt;th&gt;j&lt;/th&gt;
      &lt;th&gt;k&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;th&gt;0&lt;/th&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;5&lt;/td&gt;
      &lt;td&gt;6&lt;/td&gt;
      &lt;td&gt;7&lt;/td&gt;
      &lt;td&gt;8&lt;/td&gt;
      &lt;td&gt;9&lt;/td&gt;
      &lt;td&gt;10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;1&lt;/th&gt;
      &lt;td&gt;100&lt;/td&gt;
      &lt;td&gt;101&lt;/td&gt;
      &lt;td&gt;102&lt;/td&gt;
      &lt;td&gt;103&lt;/td&gt;
      &lt;td&gt;104&lt;/td&gt;
      &lt;td&gt;105&lt;/td&gt;
      &lt;td&gt;106&lt;/td&gt;
      &lt;td&gt;107&lt;/td&gt;
      &lt;td&gt;108&lt;/td&gt;
      &lt;td&gt;109&lt;/td&gt;
      &lt;td&gt;NaN&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p&gt;And that&apos;s all you need to know for simple pickling in python.&lt;/p&gt;
&lt;p&gt;It&apos;s an easy way to back up important objects, pass objects between scripts, or even email a python object to another pythonista (but they shouldn&apos;t open it unless they&apos;re sure you haven&apos;t given them a malicious pickle...)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Bipolar Coordinate Drawing Robot]]></title><link>https://ianlondon.github.io/posts/bipolar-coordinate-drawing-robot</link><guid isPermaLink="false">bipolar-coordinate-drawing-robot</guid><pubDate>Mon, 11 Apr 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Plot-Bot is a robot that draws SVG files onto a whiteboard. It can draw on anything you can mount flat on a wall: plywood or poster paper work too. It is controlled in the browser and uses Node.js with &lt;a href=&quot;https://github.com/rwaldron/johnny-five&quot;&gt;johnny-five&lt;/a&gt; to control 2 stepper motors via an Arduino.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://youtu.be/HxJ4MiYmpyA&quot;&gt;Video of plot-bot in action on YouTube:&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.youtube.com/vi/HxJ4MiYmpyA/0.jpg&quot; alt=&quot;Video of plot-bot in action&quot;&gt;&lt;/p&gt;
&lt;p&gt;Drawing on a whiteboard:
&lt;img src=&quot;https://github.com/IanLondon/plot-bot/raw/master/img/smiley1.jpg&quot; alt=&quot;smiley face drawing&quot;&gt;&lt;/p&gt;
&lt;p&gt;What it looks like in a browser:
&lt;img src=&quot;https://github.com/IanLondon/plot-bot/raw/master/img/smiley_in_browser.png&quot; alt=&quot;in-browser smiley drawing&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;For more info and to see the code, go to &lt;a href=&quot;https://github.com/IanLondon/plot-bot&quot;&gt;the project GitHub page&lt;/a&gt;.&lt;/strong&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Scraping and Rendering HTML in iPython Notebook]]></title><link>https://ianlondon.github.io/posts/render-html-in-ipython-notebook</link><guid isPermaLink="false">render-html-in-ipython-notebook</guid><pubDate>Mon, 11 Apr 2016 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;Requirements:&lt;/h1&gt;
&lt;p&gt;You need to have to have &lt;code&gt;selenium&lt;/code&gt; installed first: run &lt;code&gt;pip install selenium&lt;/code&gt; in the terminal or with iPython run &lt;code&gt;!pip install selenium&lt;/code&gt;.&lt;/p&gt;
&lt;h1&gt;Getting an HTML selection with selenium&lt;/h1&gt;
&lt;p&gt;First, set up a Firefox webdriver and point it to our URL of interest.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;from selenium import webdriver

driver = webdriver.Firefox()

driver.get(&amp;#39;https://en.wikipedia.org/wiki/International_Space_Station&amp;#39;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Let&apos;s select the first &lt;code&gt;&amp;#x3C;table&gt;&lt;/code&gt; element from Wikipedia&apos;s ISS article as an example.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;iss_table = driver.find_element_by_xpath(&amp;#39;//table&amp;#39;)&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;p&gt;Now we want to see if our XPath selector got us what we were looking for.&lt;/p&gt;
&lt;p&gt;We can look at the raw HTML of that first &lt;code&gt;&amp;#x3C;table&gt;&lt;/code&gt; and see it it&apos;s what we wanted. To get the raw HTML of a selected element, we can get its &lt;code&gt;outerHTML&lt;/code&gt; attribute:&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;iss_table_html = iss_table.get_attribute(&amp;#39;outerHTML&amp;#39;)

print iss_table_html[:200]
print &amp;#39;\n. . .\n&amp;#39;
print iss_table_html[-200:]&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;deckgo-highlight-code  terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&amp;lt;table class=&amp;quot;infobox&amp;quot; style=&amp;quot;font-size:88%; width:22em; text-align:left&amp;quot;&amp;gt;
&amp;lt;caption&amp;gt;International Space Station&amp;lt;/caption&amp;gt;
&amp;lt;tbody&amp;gt;&amp;lt;tr&amp;gt;
&amp;lt;td colspan=&amp;quot;3&amp;quot; style=&amp;quot;text-align:center;&amp;quot;&amp;gt;&amp;lt;a href=&amp;quot;/wiki/File:Int

. . .

ex.php?title=International_Space_Station&amp;amp;amp;action=edit&amp;quot;&amp;gt;[update]&amp;lt;/a&amp;gt;&amp;lt;/sup&amp;gt;&amp;lt;br&amp;gt;
(&amp;lt;a href=&amp;quot;/wiki/Exploded_view&amp;quot; title=&amp;quot;Exploded view&amp;quot; class=&amp;quot;mw-redirect&amp;quot;&amp;gt;exploded view&amp;lt;/a&amp;gt;)&amp;lt;/td&amp;gt;
&amp;lt;/tr&amp;gt;
&amp;lt;/tbody&amp;gt;&amp;lt;/table&amp;gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;h1&gt;Rendering the selected HTML in the notebook&lt;/h1&gt;
&lt;p&gt;Reading raw HTML isn&apos;t very nice.&lt;/p&gt;
&lt;p&gt;Let&apos;s take advantage of some iPython Notebook magic: since we&apos;re viewing the notebook in a web browser, we can also render HTML content directly in the notebook.&lt;/p&gt;
&lt;p&gt;We lose whatever CSS styling was in the scraped website, as well as anything loaded from relative links, but we can see the general structure which is often all we want anyway.&lt;/p&gt;
&lt;p&gt;This can make it much easier to see what our XPath selectors are actually pulling from the site. Is it what we intended? Scraping HTML is a messy business and selectors often surprise you, so it&apos;s nice to be able to get visual feedback.&lt;/p&gt;
&lt;p&gt;Here is the same table as above, rendered in HTML in the iPython notebook. Relative links won&apos;t work, but in the example below the image of the ISS shows up correctly because its &lt;code&gt;src&lt;/code&gt; is an absolute link.&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;# for ipython notebook display
from IPython.core.display import display, HTML

display(HTML(iss_table_html))&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;
&lt;table class=&quot;infobox&quot; style=&quot;font-size:88%; width:22em; text-align:left&quot;&gt;
&lt;caption&gt;International Space Station&lt;/caption&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td colspan=&quot;3&quot; style=&quot;text-align:center;&quot;&gt;&lt;a href=&quot;/wiki/File:International_Space_Station_after_undocking_of_STS-132.jpg&quot; class=&quot;image&quot;&gt;&lt;img alt=&quot;A rearward view of the International Space Station backdropped by the limb of the Earth. In view are the station&apos;s four large, gold-coloured solar array wings, two on either side of the station, mounted to a central truss structure. Further along the truss are six large, white radiators, three next to each pair of arrays. In between the solar arrays and radiators is a cluster of pressurised modules arranged in an elongated T shape, also attached to the truss. A set of blue solar arrays are mounted to the module at the aft end of the cluster.&quot; src=&quot;//upload.wikimedia.org/wikipedia/commons/thumb/0/04/International_Space_Station_after_undocking_of_STS-132.jpg/300px-International_Space_Station_after_undocking_of_STS-132.jpg&quot; srcset=&quot;//upload.wikimedia.org/wikipedia/commons/thumb/0/04/International_Space_Station_after_undocking_of_STS-132.jpg/450px-International_Space_Station_after_undocking_of_STS-132.jpg 1.5x, //upload.wikimedia.org/wikipedia/commons/thumb/0/04/International_Space_Station_after_undocking_of_STS-132.jpg/600px-International_Space_Station_after_undocking_of_STS-132.jpg 2x&quot; data-file-width=&quot;3319&quot; data-file-height=&quot;2116&quot; height=&quot;191&quot; width=&quot;300&quot;&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan=&quot;3&quot; style=&quot;font-size:90%; line-height:15px; text-align:center;&quot;&gt;The International Space Station on 23 May 2010 as seen from the departing &lt;a href=&quot;/wiki/Space_Shuttle&quot; title=&quot;Space Shuttle&quot;&gt;Space Shuttle&lt;/a&gt;&amp;nbsp;&lt;a href=&quot;/wiki/Space_Shuttle_Atlantis&quot; title=&quot;Space Shuttle Atlantis&quot;&gt;&lt;i&gt;Atlantis&lt;/i&gt;&lt;/a&gt; during &lt;a href=&quot;/wiki/STS-132&quot; title=&quot;STS-132&quot;&gt;STS-132&lt;/a&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center;&quot; colspan=&quot;3&quot;&gt;Station statistics&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;&lt;a href=&quot;/wiki/International_Designator&quot; title=&quot;International Designator&quot;&gt;COSPAR ID&lt;/a&gt;&lt;/th&gt;
&lt;td&gt;1998-067A&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;&lt;a href=&quot;/wiki/Call_sign&quot; title=&quot;Call sign&quot;&gt;Call sign&lt;/a&gt;&lt;/th&gt;
&lt;td&gt;&lt;i&gt;Alpha&lt;/i&gt;, &lt;i&gt;Station&lt;/i&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Crew&lt;/th&gt;
&lt;td&gt;Fully crewed: 6&lt;br&gt;
Currently aboard: 6&lt;br&gt;
(&lt;a href=&quot;/wiki/Expedition_47&quot; title=&quot;Expedition 47&quot;&gt;Expedition 47&lt;/a&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;&lt;a href=&quot;/wiki/Rocket_launch&quot; title=&quot;Rocket launch&quot;&gt;Launch&lt;/a&gt;&lt;/th&gt;
&lt;td&gt;20 November 1998&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;&lt;a href=&quot;/wiki/Launch_pad&quot; title=&quot;Launch pad&quot;&gt;Launch pad&lt;/a&gt;&lt;/th&gt;
&lt;td&gt;&lt;span class=&quot;nowrap&quot;&gt;&lt;a href=&quot;/wiki/Baikonur_Cosmodrome&quot; title=&quot;Baikonur Cosmodrome&quot;&gt;Baikonur&lt;/a&gt; &lt;a href=&quot;/wiki/Gagarin%27s_Start&quot; title=&quot;Gagarin&apos;s Start&quot;&gt;1/5&lt;/a&gt; and &lt;a href=&quot;/wiki/Baikonur_Cosmodrome_Site_81&quot; title=&quot;Baikonur Cosmodrome Site 81&quot;&gt;81/23&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;/wiki/Kennedy_Space_Center&quot; title=&quot;Kennedy Space Center&quot;&gt;Kennedy&lt;/a&gt; &lt;a href=&quot;/wiki/Kennedy_Space_Center_Launch_Complex_39&quot; title=&quot;Kennedy Space Center Launch Complex 39&quot;&gt;LC-39&lt;/a&gt;&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;&lt;a href=&quot;/wiki/Mass&quot; title=&quot;Mass&quot;&gt;Mass&lt;/a&gt;&lt;/th&gt;
&lt;td&gt;Appx. 419,455&amp;nbsp;kg (924,740&amp;nbsp;lb)&lt;sup id=&quot;cite_ref-ISS_stats_1-0&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-ISS_stats-1&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Length&lt;/th&gt;
&lt;td&gt;72.8&amp;nbsp;m (239&amp;nbsp;ft)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Width&lt;/th&gt;
&lt;td&gt;108.5&amp;nbsp;m (356&amp;nbsp;ft)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Height&lt;/th&gt;
&lt;td&gt;c. 20&amp;nbsp;m (c. 66&amp;nbsp;ft)&lt;br&gt;
&lt;small&gt;nadirâ€“zenith, arrays forwardâ€“aft&lt;/small&gt;&lt;br&gt;
&lt;small&gt;(27 November 2009)&lt;sup class=&quot;noprint Inline-Template&quot; style=&quot;margin-left:0.1em; white-space:nowrap;&quot;&gt;[&lt;i&gt;&lt;a href=&quot;/wiki/Wikipedia:Manual_of_Style/Dates_and_numbers#Precise_language&quot; title=&quot;Wikipedia:Manual of Style/Dates and numbers&quot;&gt;&lt;span title=&quot;MRM-1 &amp;amp; MRM-2&quot;&gt;dated info&lt;/span&gt;&lt;/a&gt;&lt;/i&gt;]&lt;/sup&gt;&lt;/small&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Pressurised &lt;a href=&quot;/wiki/Volume&quot; title=&quot;Volume&quot;&gt;volume&lt;/a&gt;&lt;/th&gt;
&lt;td&gt;916&amp;nbsp;m&lt;sup&gt;3&lt;/sup&gt; (32,300&amp;nbsp;cu&amp;nbsp;ft)&lt;br&gt;
&lt;small&gt;(3 November 2014)&lt;/small&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;&lt;a href=&quot;/wiki/Atmospheric_pressure&quot; title=&quot;Atmospheric pressure&quot;&gt;Atmospheric pressure&lt;/a&gt;&lt;/th&gt;
&lt;td&gt;101.3&amp;nbsp;&lt;a href=&quot;/wiki/Pascal_(unit)&quot; title=&quot;Pascal (unit)&quot;&gt;kPa&lt;/a&gt; (29.91&amp;nbsp;&lt;a href=&quot;/wiki/Inch_of_mercury&quot; title=&quot;Inch of mercury&quot;&gt;inHg&lt;/a&gt;, 1 &lt;a href=&quot;/wiki/Atmosphere_(unit)&quot; title=&quot;Atmosphere (unit)&quot;&gt;atm&lt;/a&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;&lt;a href=&quot;/wiki/Apsis&quot; title=&quot;Apsis&quot;&gt;Perigee&lt;/a&gt;&lt;/th&gt;
&lt;td&gt;409&amp;nbsp;km (254&amp;nbsp;mi) &lt;a href=&quot;/wiki/Above_mean_sea_level&quot; title=&quot;Above mean sea level&quot; class=&quot;mw-redirect&quot;&gt;AMSL&lt;/a&gt;&lt;sup id=&quot;cite_ref-heavens-above_2-0&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-heavens-above-2&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;&lt;a href=&quot;/wiki/Apsis&quot; title=&quot;Apsis&quot;&gt;Apogee&lt;/a&gt;&lt;/th&gt;
&lt;td&gt;416&amp;nbsp;km (258&amp;nbsp;mi) &lt;a href=&quot;/wiki/Above_mean_sea_level&quot; title=&quot;Above mean sea level&quot; class=&quot;mw-redirect&quot;&gt;AMSL&lt;/a&gt;&lt;sup id=&quot;cite_ref-heavens-above_2-1&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-heavens-above-2&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Orbital &lt;a href=&quot;/wiki/Inclination&quot; title=&quot;Inclination&quot; class=&quot;mw-redirect&quot;&gt;inclination&lt;/a&gt;&lt;/th&gt;
&lt;td&gt;51.65&amp;nbsp;&lt;a href=&quot;/wiki/Degree_(angle)&quot; title=&quot;Degree (angle)&quot;&gt;degrees&lt;/a&gt;&lt;sup id=&quot;cite_ref-heavens-above_2-2&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-heavens-above-2&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Average speed&lt;/th&gt;
&lt;td&gt;7.66 kilometres per second (27,600&amp;nbsp;km/h; 17,100&amp;nbsp;mph)&lt;sup id=&quot;cite_ref-heavens-above_2-3&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-heavens-above-2&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;&lt;a href=&quot;/wiki/Orbital_period&quot; title=&quot;Orbital period&quot;&gt;Orbital period&lt;/a&gt;&lt;/th&gt;
&lt;td&gt;92.69&amp;nbsp;minutes&lt;sup id=&quot;cite_ref-heavens-above_2-4&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-heavens-above-2&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Orbit epoch&lt;/th&gt;
&lt;td&gt;25 January 2015&lt;sup id=&quot;cite_ref-heavens-above_2-5&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-heavens-above-2&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Days in orbit&lt;/th&gt;
&lt;td&gt;6353&lt;br&gt;
&lt;small&gt;(12 April)&lt;/small&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Days occupied&lt;/th&gt;
&lt;td&gt;5640&lt;br&gt;
&lt;small&gt;(12 April)&lt;/small&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Number of orbits&lt;/th&gt;
&lt;td&gt;95912&lt;sup id=&quot;cite_ref-heavens-above_2-6&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-heavens-above-2&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;&lt;a href=&quot;/wiki/Orbital_decay&quot; title=&quot;Orbital decay&quot;&gt;Orbital decay&lt;/a&gt;&lt;/th&gt;
&lt;td&gt;2&amp;nbsp;km/month&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;font-size:90%; line-height:15px; text-align:center;&quot; colspan=&quot;3&quot;&gt;Statistics as of 9 March 2011&lt;br&gt;
(unless noted otherwise)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;font-size:90%; line-height:15px; text-align:center;&quot; colspan=&quot;3&quot;&gt;References: &lt;sup id=&quot;cite_ref-ISS_stats_1-1&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-ISS_stats-1&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;&lt;sup id=&quot;cite_ref-heavens-above_2-7&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-heavens-above-2&quot;&gt;[2]&lt;/a&gt;&lt;/sup&gt;&lt;sup id=&quot;cite_ref-ISStD_3-0&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-ISStD-3&quot;&gt;[3]&lt;/a&gt;&lt;/sup&gt;&lt;sup id=&quot;cite_ref-OnOrbit_4-0&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-OnOrbit-4&quot;&gt;[4]&lt;/a&gt;&lt;/sup&gt;&lt;sup id=&quot;cite_ref-5&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-5&quot;&gt;[5]&lt;/a&gt;&lt;/sup&gt;&lt;sup id=&quot;cite_ref-6&quot; class=&quot;reference&quot;&gt;&lt;a href=&quot;#cite_note-6&quot;&gt;[6]&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center;&quot; colspan=&quot;3&quot;&gt;Configuration&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center;&quot; colspan=&quot;3&quot;&gt;&lt;a href=&quot;/wiki/File:ISS_configuration_2015-05_en.svg&quot; class=&quot;image&quot; title=&quot;Station elements as of  May 2015[update](exploded view)&quot;&gt;&lt;img alt=&quot;The components of the ISS in an exploded diagram, with modules on-orbit highlighted in orange, and those still awaiting launch in blue or pink&quot; src=&quot;//upload.wikimedia.org/wikipedia/commons/thumb/d/d1/ISS_configuration_2015-05_en.svg/300px-ISS_configuration_2015-05_en.svg.png&quot; srcset=&quot;//upload.wikimedia.org/wikipedia/commons/thumb/d/d1/ISS_configuration_2015-05_en.svg/450px-ISS_configuration_2015-05_en.svg.png 1.5x, //upload.wikimedia.org/wikipedia/commons/thumb/d/d1/ISS_configuration_2015-05_en.svg/600px-ISS_configuration_2015-05_en.svg.png 2x&quot; data-file-width=&quot;1257&quot; data-file-height=&quot;864&quot; height=&quot;206&quot; width=&quot;300&quot;&gt;&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan=&quot;3&quot; style=&quot;font-size:90%; line-height:15px; text-align:center;&quot;&gt;Station elements as of May 2015&lt;sup class=&quot;plainlinks noprint asof-tag update&quot; style=&quot;display:none;&quot;&gt;&lt;a class=&quot;external text&quot; href=&quot;//en.wikipedia.org/w/index.php?title=International_Space_Station&amp;amp;action=edit&quot;&gt;[update]&lt;/a&gt;&lt;/sup&gt;&lt;br&gt;
(&lt;a href=&quot;/wiki/Exploded_view&quot; title=&quot;Exploded view&quot; class=&quot;mw-redirect&quot;&gt;exploded view&lt;/a&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;p&gt;Much nicer!&lt;/p&gt;
&lt;deckgo-highlight-code language=&quot;python&quot; terminal=&quot;carbon&quot; theme=&quot;vscode&quot;  &gt;
          &lt;code slot=&quot;code&quot;&gt;&lt;/code&gt;
        &lt;/deckgo-highlight-code&gt;</content:encoded></item><item><title><![CDATA[Web Scraping With XPath]]></title><link>https://ianlondon.github.io/posts/web-scraping-with-xpath</link><guid isPermaLink="false">web-scraping-with-xpath</guid><pubDate>Mon, 11 Apr 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;XPath is very powerful, it&apos;s kind of a query language like SQL but for XML documents, including HTML documents, so it is a natural fit for web scraping. A lot of people never learn it and use CSS selectors and regex, and have a really hard time scraping anything complicated.&lt;/p&gt;
&lt;p&gt;Regex is great for parsing text, but not XML/HTML -- see &lt;a href=&quot;http://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454&quot;&gt;this famous StackOverflow answer&lt;/a&gt; about it:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/bec20ecdca4c5ddb549fae90e152229c/5d030/regex_html_SO.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 93.24324324324323%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAADEklEQVR42n1U2XLaShDl/38mb/6Be504uQnGWEJCoxktCGSWMnBZhBDm5HQLQypxZaq6Zus+fXqZ6Wy3W6T5CLG1KIoCMs7n819FxvF4xOFwUKkPNebzOWbzGTrntxOOywm2mw1li0NFpaq6KldcV4cKdVWjrmvs9/vr+b7at/cXESedIw8X3j8oizGcTZAmDqlL4UyMhPsszXSfxA6J4z5OkVqHOLaUGHFkMSpGqr/5f4NOczohKUsaZfC9AecEJjIwVHaGRlw7GjvH9dAQOEFMY8fZchaHop9zXq/W6NRNjWzmkGcjmDBWJTGKgogAERkn6l2BmefEOQz8AFmSKZhEMQyGer98XaKDy5iMJ7x0qmDIJCY7x73lLE5sbPTOGgMbxQrsYnFuVUdsJY9XQPEoihKWhCcsHffDkEwFhKDCVsEkh6IbGg0/SVJEYYiX8uUGWI7LNixl47QIErJ4F2fCLmWIApSxSBJuwXaTKFzitEBalHfAcVYQIFY2GjIlIjtZWyqbcKhsDSUchMo0GrS5EwJSlBNb8MawmGBIBUNACS1g4kXZRMLYag7FgbSOhmmcgtpLRKL7KkU5vzMcj2FtTE85+yxhXpK2KJGwIwtWWGZpEad3VlssvhQko500/BWwGI0QMWdDiu/5NIyu1ZM0SDqMpqBlKcwkb5YFFCIpC1NVAnh5m2maotd9VKDA9+H3PQyefYYSaQ7ltQgjd3GgaZDGzjJ9YcEgwGK+uDHMs7xNtrwKMgv8Abz+c1ttGoYsiu956PWe0H/20P3+Az4dyuvy+74+hOnL7MZQvEjIYRAo2IAeh0HrIM9zves+PuJHt4uHLw/49/4efTqU8+jyina73S9tw69LQvv68E3ZPD094fP9F/Qee/B9Xz8Bj2n47+s33N3dKcvVcoXZdIoR8z+fzfnv4Qa4Xq71T3uZlLxcYEGZUrmUPc+b5ogj/73ddoflaqUV/WhcAZtjo39h0zR/fKa77ZHVn+J1vcF6u0dzetPzum7/ztbmN8CPxrtSWZ7w6dMrVye8vd0cfcTwJ+Aheyn/MnzjAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;StackOverflow - Regex for HTML?&quot;
        title=&quot;&quot;
        src=&quot;/static/bec20ecdca4c5ddb549fae90e152229c/fcda8/regex_html_SO.png&quot;
        srcset=&quot;/static/bec20ecdca4c5ddb549fae90e152229c/12f09/regex_html_SO.png 148w,
/static/bec20ecdca4c5ddb549fae90e152229c/e4a3f/regex_html_SO.png 295w,
/static/bec20ecdca4c5ddb549fae90e152229c/fcda8/regex_html_SO.png 590w,
/static/bec20ecdca4c5ddb549fae90e152229c/5d030/regex_html_SO.png 771w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;CSS selectors are useful but not quite as powerful as XPath.&lt;/p&gt;
&lt;p&gt;A simple example of XPath looks like this: &lt;code&gt;//div[contains(@class, &quot;price&quot;)]//text()&lt;/code&gt; This means &quot;look for any div whose &lt;code&gt;class&lt;/code&gt; attribute contains &apos;price&apos;, and give me the text inside each of those divs&quot;. The result might be something like [&quot;$39&quot;,&quot;$42&quot;] if our divs are &lt;code&gt;&amp;#x3C;div class=&apos;price foo&apos;&gt;$34&amp;#x3C;/div&gt; ... blah blah ... &amp;#x3C;div class=&apos;price spam&apos;&gt;$42&amp;#x3C;/div&gt;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;For testing out and tweaking your XPath queries, the best tool I know is this Firefox plugin: &lt;a href=&quot;https://addons.mozilla.org/en-US/firefox/addon/xpath-checker/&quot;&gt;https://addons.mozilla.org/en-US/firefox/addon/xpath-checker/&lt;/a&gt; -- it gives you a pretty-looking CSS-styled view of what a given XPath query returns. It&apos;s much easier than looking at the raw HTML. I don&apos;t know of any good extensions in Chrome.&lt;/p&gt;
&lt;p&gt;I learned from &lt;a href=&quot;http://www.w3schools.com/xsl/xpath_intro.asp&quot;&gt;http://www.w3schools.com/xsl/xpath_intro.asp&lt;/a&gt; but I found that site really hard to follow for anything but the basics.&lt;/p&gt;
&lt;h1&gt;TODO: A REAL XPATH TUTORIAL HERE&lt;/h1&gt;
&lt;p&gt;Check out this incredibly handy cheat sheet:
&lt;a href=&quot;http://ricostacruz.com/cheatsheets/xpath.html&quot;&gt;http://ricostacruz.com/cheatsheets/xpath.html&lt;/a&gt;&lt;/p&gt;</content:encoded></item></channel></rss>